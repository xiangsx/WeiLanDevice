(()=>{"use strict";var e={540:(e,t,n)=>{const o=require("net"),r=require("struct");function a(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c,l,f,u="word8",d="word8",_="word8",h="word16Ule",g="word32Ube",y="word32Ule",S="array",v="chars",m="struct",N=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._defineArr=t,this._struct=this.getStruct(),this.length=this._struct.allocate().buffer().length}var t,n;return t=e,(n=[{key:"getStruct",value:function(){var t,n,o=(0,r.Struct)(),i=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw s}}}}(this._defineArr);try{for(i.s();!(t=i.n()).done;){var c,l=t.value,f=l[0],u=l[1],d=l[2]||[];if(f&&u)if(f===m)if(1===d.length){var _=d[0];_ instanceof e?o=o[f](u,_.getStruct()):console.log("inner struct define invalid,please input custom MsgStruct,err define :".concat(this._defineArr))}else console.error("msg struct define invalid, invalid struct :".concat(JSON.stringify(this._defineArr)));else o=(c=o)[f].apply(c,[u].concat(function(e){if(Array.isArray(e))return s(e)}(n=d)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||a(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));else console.error("msg struct define error，fieldName:[".concat(u,"],type:[").concat(f,"],optionArr:[").concat(d,"]"))}}catch(e){i.e(e)}finally{i.f()}return o}},{key:"getObj",value:function(e){return this._struct._setBuff(e),this._struct.fields}},{key:"getBuff",value:function(e){return this._struct.set(e),this._struct.buffer()}}])&&i(t.prototype,n),e}();function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}c=N,l="CustomStruct",f=r.Struct,l in c?Object.defineProperty(c,l,{value:f,enumerable:!0,configurable:!0,writable:!0}):c[l]=f;var b=[170,170,85,85],E=17,I=61441,O=61442,w=61443,U=61446,A=61451,R=61452,P=61453,F=-1,D=new Map;D.set(F,{text:"连接断开",value:F}),D.set(0,{text:"空闲状态",value:0}),D.set(1,{text:"同步或扫频中",value:1}),D.set(2,{text:"小区激活中",value:2}),D.set(3,{text:"小区已激活",value:3}),D.set(4,{text:"小区去激活中",value:4});var T=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"SYS_INIT_SUCC_IND",new N([[h,"CellState"],[h,"Band"],[y,"ulEarfcn"],[y,"dlEarfcn"],[v,"PLMN",[7]],[u,"Bandwidth"],[h,"PCI"],[h,"TAC"]])),p(this,"SYS_ARFCN_CFG",new N([[y,"ulEarfcn"],[y,"dlEarfcn"],[v,"PLMN",[7]],[_,"Bandwidth"],[y,"Band"],[h,"PCI"],[h,"TAC"],[y,"CellId"],[h,"UePMax"],[h,"EnodeBPMax"]])),p(this,"UE_INFO_RPT",new N([[y,"UeIdType "],[v,"IMSI",[E]],[v,"IMEI",[17]],[_,"RSSI"],[_,"STMSIPresent"],[S,"S_TMSI",[5,_]],[S,"Res",[3,_]]])),p(this,"SET_ADMIN_STATE_CFG",new N([[y,"workAdminState"]])),p(this,"ENB_STATE_IND",new N([[y,"CellStateInd"]])),p(this,"PWR1_DEREASE_CFG",new N([[y,"Pwr1Derease"],[_,"IsSave"],[S,"Res",[3,_]]])),p(this,"POWER_DEREASE_QUERY_ACK",new N([[_,"RxGainValueFromReg"],[_,"RxGainValueFromMib"],[_,"PowerDereaseValueFromReg"],[_,"PowerDereaseValueFromMib"],[_,"AgcFlag"],[_,"SnfRxGainValueFromReg"],[_,"SnfRxGainValueFromMib"],[_,"Res"]])),p(this,"MEAS_UE_CFG",new N([[_,"WorkMode"],[_,"RedirectSubMode"],[h,"CapturePeriod"],[v,"IMSI",[E]],[_,"MeasReportPeriod"],[_,"SchdUeMaxPowerTxFlag"],[_,"SchdUeMaxPowerValue"],[_,"SchdUeUlFixedPrbSwitch"],[_,"CampOnAllowedFlag"],[_,"SrsSwitch"],[_,"Res"],[_,"ControlSubMode"],[S,"Res1",[3,_]]])),p(this,"MEAS_INFO_RPT",new N([[_,"UeMeasValue"],[v,"IMSI",[E]],[_,"Res"],[_,"ProtocolVer"]])),p(this,"SYS_MODE_CFG",new N([[y,"sysMode"]])),p(this,"CELL_STATE_INFO",new N([[y,"CellState"]])),p(this,"ARFCN_MOD",new N([[y,"ulEarfcn"],[y,"dlEarfcn"],[v,"PLMN",[7]],[_,"Band"],[y,"CellId"],[h,"UePMax"]])),p(this,"BASE_INFO_QUERY",new N([[y,"EnbBaseInfoType"]])),p(this,"BASE_INFO_QUERY_ACK",new N([[y,"EnbBaseInfoType"],[v,"EnbBaseInfo",[100]]])),p(this,"REBOOT_CFG",new N([[y,"SelfActiveCfg"]])),p(this,"MULTI_BAND_POWERDEREASE_QUERY_ACK",new N([[u,"NumElem"],[v,"Reserved",[3]],[S,"bandPwrdereaseMap",[32,m,N.CustomStruct().word8("band").word8("Pwrderease").chars("Reserved",2)]]])),p(this,"SYS_RXGAIN_CFG",new N([[y,"RxGain"],[u,"RxGainSaveFlag"],[u,"RxOrSnfFlag"],[v,"Res",[3]]])),p(this,"SELFCFG_CELLPARA_REQ",new N([[u,"SelfBand"],[v,"Res",[3]]])),p(this,"_remInfoPrtMain",new N([[h,"collectionCellNum"],[h,"collectionTypeFlag"]])),p(this,"_wrFLCellInfo",new N([[y,"dlEarfcn"],[h,"PCI"],[h,"TAC"],[h,"PLMN"],[h,"TddSfAssignment"],[y,"CellId"],[y,"Priority"],[u,"RSRP"],[u,"RSRQ"],[u,"Bandwidth"],[u,"TddSpecialSfPatterns"]])),p(this,"_wrIntraFreqNeighCellInfo",new N([[y,"dlEarfcn"],[h,"PCI"],[h,"QoffsetCell"]])),p(this,"_stFlLteIntreFreqLst",new N([[y,"dlEarfcn"],[u,"cellReselectPriotry"],[u,"Q_offsetFreq"],[h,"measBandWidth"],[y,"interFreqNghNum"]])),p(this,"_wrFLInterNeighCellInfo",new N([[h,"PCI"],[h,"QoffsetCell"]])),p(this,"REM_INFO_RPT",{length:0,getObj:function(e){try{var n,o=e.length,r=t._remInfoPrtMain.length,a=e.slice(0,r),s=t._remInfoPrtMain.getObj(a);n=r;for(var i=[];o>n;){var c={stCellInfo:[],IntraFreqNeighCellNum:0,stIntraFreqNeighCellInfo:[],InterFreqNum:0,stInterFreqLstInfo:[]},l=t._wrFLCellInfo.length;a=e.slice(n,n+l),c.stCellInfo=t._wrFLCellInfo.getObj(a),c.stCellInfo.Priority>7&&(c.stCellInfo.Priority=0),n+=l,a=e.slice(n,n+4);var f=new Int32Array(a)[0];c.IntraFreqNeighCellNum=f,n+=4;for(var u=[],d=0;d<f;d+=1){var _=t._wrIntraFreqNeighCellInfo.length;a=e.slice(n,n+_),u.push(t._wrIntraFreqNeighCellInfo.getObj(a)),n+=l}c.stIntraFreqNeighCellInfo=u,a=e.slice(n,n+4);var h=new Int32Array(a)[0];c.InterFreqNum=h,n+=4;for(var g=[],y=0;y<h;y+=1){var S=t._stFlLteIntreFreqLst.length;a=e.slice(n,n+S);var v=t._stFlLteIntreFreqLst.getObj(a);n+=S,v.stInterFreqNeighCell=[];for(var m=0;m<v.interFreqNghNum;m+=1){var N=t._wrFLInterNeighCellInfo.length;a=e.slice(n,n+N),v.stInterFreqNeighCell.push(t._wrFLInterNeighCellInfo.getObj(a)),n+=N}g.push(v)}if(c.stInterFreqLstInfo=g,i.push(JSON.parse(JSON.stringify(c))),console.debug("########################################"),console.debug(JSON.stringify(c)),console.debug("########################################"),i.length===s.collectionCellNum)break}return s.stCollCellInfo=i,s}catch(e){return console.error("parsing rem info prt failed, err = ",e),null}}}),p(this,"REM_CFG",new N([[y,"wholeBandRem"],[y,"sysEarfcnNum"],[S,"sysEarfcn",[10,y]]])),p(this,"CONTROL_LIST_QUERY",new N([[u,"ControlListType"],[S,"Res",[3,_]]])),p(this,"CONTROL_LIST_QUERY_ACK",{getObj:function(e){var t=e.slice(0,2),n=new N([[u,"ControlListProperty"],[u,"ControlListUENum"]]).getObj(t),o=C(C({},n),{},{ControlListUEId:[]});if(n.ControlListUENum>0){var r=e.slice(2,e.length);o.ControlListUEId=Object.values(new N([[S,"ControlListUEId",[n.ControlListUENum,v,E]]]).getObj(r).ControlListUEId)}return o}}),p(this,"CONTROL_UE_LIST_CFG",{getBuff:function(e){return new N([[u,"ControlMovement"],[u,"ControlUENum"],[u,"ControlUEProperty"],[S,"ControlUEIdentity",[e.ControlUENum,v,E]],[u,"ClearType"],[u,"RejCause"],[u,"Res"]]).getBuff(e)}}),p(this,"CONTROL_UE_LIST_CFG_ACK",{getObj:function(e){var t=e.slice(0,2),n=new N([[u,"CfgResult"],[u,"IgnoreUENum"]]).getObj(t),o=C(C({},n),{},{IgnoreUEList:[]});if(n.IgnoreUENum>0){var r=e.slice(2,e.length);o.IgnoreUEList=Object.values(new N([[S,"IgnoreUEList",[n.IgnoreUENum,v,E]]]).getObj(r).IgnoreUEList)}return o}}),p(this,"COMMON_SET_ACK",new N([[y,"CfgResult"]])),p(this,"COMMON_QUERY",new N([])),this.HEAD=new N([[y,"FrameHeader"],[h,"MsgType"],[h,"MsgLength"],[h,"Frame"],[h,"SubSysCode"]]),this.HEAD_LENGTH=this.HEAD.length,this._MsgStructMap=new Map,this._initMsgStructMap()}var t,n;return t=e,(n=[{key:"getBodyStruct",value:function(e){return this._MsgStructMap.has(e)||console.warn("LteProto.getBodyStruct error invalid ".concat(e,", please make sure you define this struct before")),this._MsgStructMap.get(e)}},{key:"_initMsgStructMap",value:function(){this._MsgStructMap.set(61456,this.SYS_INIT_SUCC_IND),this._MsgStructMap.set(61457,this.COMMON_QUERY),this._MsgStructMap.set(w,this.SYS_ARFCN_CFG),this._MsgStructMap.set(61445,this.UE_INFO_RPT),this._MsgStructMap.set(61444,this.COMMON_SET_ACK),this._MsgStructMap.set(P,this.SET_ADMIN_STATE_CFG),this._MsgStructMap.set(61454,this.COMMON_SET_ACK),this._MsgStructMap.set(61465,this.ENB_STATE_IND),this._MsgStructMap.set(61461,this.PWR1_DEREASE_CFG),this._MsgStructMap.set(61462,this.COMMON_SET_ACK),this._MsgStructMap.set(61489,this.COMMON_QUERY),this._MsgStructMap.set(61490,this.POWER_DEREASE_QUERY_ACK),this._MsgStructMap.set(61479,this.COMMON_QUERY),this._MsgStructMap.set(U,this.MEAS_UE_CFG),this._MsgStructMap.set(61447,this.COMMON_SET_ACK),this._MsgStructMap.set(61480,this.SYS_ARFCN_CFG),this._MsgStructMap.set(61501,this.COMMON_QUERY),this._MsgStructMap.set(61502,this.MEAS_UE_CFG),this._MsgStructMap.set(61448,this.MEAS_INFO_RPT),this._MsgStructMap.set(I,this.SYS_MODE_CFG),this._MsgStructMap.set(O,this.COMMON_SET_ACK),this._MsgStructMap.set(61487,this.COMMON_QUERY),this._MsgStructMap.set(61488,this.CELL_STATE_INFO),this._MsgStructMap.set(61568,this.ARFCN_MOD),this._MsgStructMap.set(61569,this.COMMON_SET_ACK),this._MsgStructMap.set(61483,this.BASE_INFO_QUERY),this._MsgStructMap.set(61484,this.BASE_INFO_QUERY_ACK),this._MsgStructMap.set(A,this.REBOOT_CFG),this._MsgStructMap.set(R,this.COMMON_SET_ACK),this._MsgStructMap.set(61610,this.MULTI_BAND_POWERDEREASE_QUERY_ACK),this._MsgStructMap.set(61609,this.COMMON_QUERY),this._MsgStructMap.set(61459,this.SYS_RXGAIN_CFG),this._MsgStructMap.set(61460,this.COMMON_SET_ACK),this._MsgStructMap.set(61519,this.SELFCFG_CELLPARA_REQ),this._MsgStructMap.set(61520,this.COMMON_SET_ACK),this._MsgStructMap.set(61450,this.REM_INFO_RPT),this._MsgStructMap.set(61449,this.REM_CFG),this._MsgStructMap.set(61507,this.CONTROL_LIST_QUERY),this._MsgStructMap.set(61508,this.CONTROL_LIST_QUERY_ACK),this._MsgStructMap.set(61497,this.CONTROL_UE_LIST_CFG),this._MsgStructMap.set(61498,this.CONTROL_UE_LIST_CFG_ACK)}}])&&M(t.prototype,n),e}(),x=new Map;x.set(0,{value:0,text:"空口同步成功",CellState:2}),x.set(1,{value:1,text:"空口同步失败",CellState:2}),x.set(2,{value:2,text:"GPS同步成功",CellState:4}),x.set(3,{value:3,text:"GPS同步失败",CellState:2}),x.set(4,{value:4,text:"扫频成功",CellState:0}),x.set(5,{value:5,text:"扫频失败",CellState:0}),x.set(6,{value:6,text:"小区建立成功",CellState:3}),x.set(7,{value:7,text:"小区建立失败",CellState:0}),x.set(8,{value:8,text:"小区去激活",CellState:0}),x.set(9,{value:9,text:"空口同步中",CellState:1}),x.set(10,{value:10,text:"GPS同步中",CellState:1}),x.set(11,{value:11,text:"扫频中",CellState:1}),x.set(12,{value:12,text:"小区建立中",CellState:2}),x.set(13,{value:13,text:"小区去激活中",CellState:4}),x.set(65535,{value:65535,text:"无效状态",CellState:0});var k=100,B=new Map;B.set(25,{value:25,text:"5M"}),B.set(50,{value:50,text:"10M"}),B.set(75,{value:75,text:"15M"}),B.set(k,{value:k,text:"20M"});var j=255,V=65280,Q=new Map;Q.set(V,{value:V,text:"FDD"}),Q.set(j,{value:j,text:"TDD"});var G=new Map;G.set(0,{value:0,text:"持续侦码模式"}),G.set(1,{value:1,text:"周期侦码模式"}),G.set(2,{value:2,text:"定位模式"}),G.set(3,{value:3,text:"管控模式"}),G.set(4,{value:4,text:"重定向模式"});var J=new Map;J.set(0,{value:0,text:"120ms"}),J.set(1,{value:1,text:"240ms"}),J.set(2,{value:2,text:"480ms"}),J.set(3,{value:3,text:"640ms"}),J.set(4,{value:4,text:"1024ms"}),J.set(5,{value:5,text:"2048ms"});var H=new Map;H.set(0,{value:0,text:"R8"}),H.set(1,{value:1,text:"R10"});var Y=function(e,t){return t===V?18e3+e:255},q={DEVICE_MODEL:0,HARDWARE_VERSION:1,SOFTWARE_VERSION:2,BOARDSN:3,MAC:4,UBOOT_VERSION:5,BOARD_TEMPERATURE:6},K={CMCC:{frequencyRange:[[939,949],[1805,1830],[1880,1920],[2010,2025],[2320,2370],[2515,2675]],PLMNList:[46e3],text:"中国移动",shortHand:"移动",key:0},CUCC:{frequencyRange:[[949,960],[1830,1860],[2130,2170],[2300,2320]],PLMNList:[46001],text:"中国联通",shortHand:"联通",key:1},CTCC:{frequencyRange:[[869,894],[925,938],[1860,1880],[2110,2130],[2370,2390]],PLMNList:[46011],text:"中国电信",shortHand:"电信",key:2},OTHER:{frequencyRange:[],PLMNList:[],text:"未知",shortHand:"未知",key:-1},ALL:{frequencyRange:[],PLMNList:[],text:"全部运营商",shortHand:"全部",key:99}},W=(Q.get(j),B.get(k),D.get(F),[w,P,I,U]);function z(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $=2864434397,Z=[170,187,204,221],ee=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X(this,"_CLIENT_IP_STRUCT",new N([[S,"clientIP",[4,d]]])),X(this,"_CLIENT_MAC_STRUCT",new N([[S,"clientMAC",[6,d]]])),X(this,"_FAN_SPEED_STRUCT",new N([[d,"fanSpeed"]])),X(this,"_TEMPERATURE_STRUCT",new N([["word16Ube","temperature"]])),X(this,"_BATTERY_VOLTAGE_STRUCT",new N([[u,"batteryVoltage"]])),X(this,"_SERVER_IP_STRUCT",new N([[S,"serverIP",[4,d]]])),X(this,"_SERVER_PORT_STRUCT",new N([[g,"serverPort"]])),this.HEAD_STRUCT=new N([[g,"fixHead"],[d,"funCode"],[d,"cmd"],[d,"contentLength"]]),this.HEAD_LEN=this.HEAD_STRUCT.length,this.END_STRUCT=new N([[d,"fixEnd"]]),this.END_LEN=this.END_STRUCT.length,this.IOT_COMMON_QUERY=new N([]),this._bodyStructMap=new Map,this.initBodyStructMap()}var t,n;return t=e,(n=[{key:"initBodyStructMap",value:function(){this._bodyStructMap.set(209,this._CLIENT_IP_STRUCT),this._bodyStructMap.set(213,this._CLIENT_MAC_STRUCT),this._bodyStructMap.set(214,this._SERVER_IP_STRUCT),this._bodyStructMap.set(215,this._SERVER_PORT_STRUCT),this._bodyStructMap.set(1,this._FAN_SPEED_STRUCT),this._bodyStructMap.set(2,this._TEMPERATURE_STRUCT),this._bodyStructMap.set(3,this._BATTERY_VOLTAGE_STRUCT)}},{key:"getBodyStruct",value:function(e){return this._bodyStructMap.has(e)||console.error("IotProto.getBodyStruct not support this function code :[".concat(e,"]")),this._bodyStructMap.get(e)}}])&&z(t.prototype,n),e}(),te=new Map;te.set(0,{value:0,text:"连接断开"}),te.set(1,{value:1,text:"已连接"});const ne=require("moment");var oe=n.n(ne),re="YYYY-MM-DD HH:mm:ss",ae=new Map;ae.set(0,"用户名不存在"),ae.set(1,"密码不正确"),ae.set(2,"软件版本已过期");var se={"192.168.2.53":[39,3,34],"192.168.2.54":[38,40,41,1,5,8]};const ie=JSON.parse('{"1":{"band":1,"FDL_low":2110,"NOffs_DL":0,"NDL_min":0,"NDL_max":599,"FUL_low":1920,"NOffs_UL":18000,"NUL_min":18000,"NUL_max":18599},"2":{"band":2,"FDL_low":1930,"NOffs_DL":600,"NDL_min":600,"NDL_max":1199,"FUL_low":1850,"NOffs_UL":18600,"NUL_min":18600,"NUL_max":19199},"3":{"band":3,"FDL_low":1805,"NOffs_DL":1200,"NDL_min":1200,"NDL_max":1949,"FUL_low":1710,"NOffs_UL":19200,"NUL_min":19200,"NUL_max":19949},"4":{"band":4,"FDL_low":2110,"NOffs_DL":1950,"NDL_min":1950,"NDL_max":2399,"FUL_low":1710,"NOffs_UL":19950,"NUL_min":19950,"NUL_max":20399},"5":{"band":5,"FDL_low":869,"NOffs_DL":2400,"NDL_min":2400,"NDL_max":2649,"FUL_low":824,"NOffs_UL":20400,"NUL_min":20400,"NUL_max":20649},"6":{"band":6,"FDL_low":875,"NOffs_DL":2650,"NDL_min":2650,"NDL_max":2749,"FUL_low":830,"NOffs_UL":20650,"NUL_min":20650,"NUL_max":20749},"7":{"band":7,"FDL_low":2620,"NOffs_DL":2750,"NDL_min":2750,"NDL_max":3449,"FUL_low":2500,"NOffs_UL":20750,"NUL_min":20750,"NUL_max":21449},"8":{"band":8,"FDL_low":925,"NOffs_DL":3450,"NDL_min":3450,"NDL_max":3799,"FUL_low":880,"NOffs_UL":21450,"NUL_min":21450,"NUL_max":21799},"9":{"band":9,"FDL_low":1844.9,"NOffs_DL":3800,"NDL_min":3800,"NDL_max":4149,"FUL_low":1749.9,"NOffs_UL":21800,"NUL_min":21800,"NUL_max":22149},"10":{"band":10,"FDL_low":2110,"NOffs_DL":4150,"NDL_min":4150,"NDL_max":4749,"FUL_low":1710,"NOffs_UL":22150,"NUL_min":22150,"NUL_max":22749},"11":{"band":11,"FDL_low":1475.9,"NOffs_DL":4750,"NDL_min":4750,"NDL_max":4949,"FUL_low":1427.9,"NOffs_UL":22750,"NUL_min":22750,"NUL_max":22949},"12":{"band":12,"FDL_low":729,"NOffs_DL":5010,"NDL_min":5010,"NDL_max":5179,"FUL_low":699,"NOffs_UL":23010,"NUL_min":23010,"NUL_max":23179},"13":{"band":13,"FDL_low":746,"NOffs_DL":5180,"NDL_min":5180,"NDL_max":5279,"FUL_low":777,"NOffs_UL":23180,"NUL_min":23180,"NUL_max":23279},"14":{"band":14,"FDL_low":758,"NOffs_DL":5280,"NDL_min":5280,"NDL_max":5379,"FUL_low":788,"NOffs_UL":23280,"NUL_min":23280,"NUL_max":23379},"17":{"band":17,"FDL_low":734,"NOffs_DL":5730,"NDL_min":5730,"NDL_max":5849,"FUL_low":704,"NOffs_UL":23730,"NUL_min":23730,"NUL_max":23849},"18":{"band":18,"FDL_low":860,"NOffs_DL":5850,"NDL_min":5850,"NDL_max":5999,"FUL_low":815,"NOffs_UL":23850,"NUL_min":23850,"NUL_max":23999},"19":{"band":19,"FDL_low":875,"NOffs_DL":6000,"NDL_min":6000,"NDL_max":6149,"FUL_low":830,"NOffs_UL":24000,"NUL_min":24000,"NUL_max":24149},"20":{"band":20,"FDL_low":791,"NOffs_DL":6150,"NDL_min":6150,"NDL_max":6449,"FUL_low":832,"NOffs_UL":24150,"NUL_min":24150,"NUL_max":24449},"21":{"band":21,"FDL_low":1495.9,"NOffs_DL":6450,"NDL_min":6450,"NDL_max":6599,"FUL_low":1447.9,"NOffs_UL":24450,"NUL_min":24450,"NUL_max":24599},"22":{"band":22,"FDL_low":3510,"NOffs_DL":6600,"NDL_min":6600,"NDL_max":7399,"FUL_low":3410,"NOffs_UL":24600,"NUL_min":24600,"NUL_max":25399},"23":{"band":23,"FDL_low":2180,"NOffs_DL":7500,"NDL_min":7500,"NDL_max":7699,"FUL_low":2000,"NOffs_UL":25500,"NUL_min":25500,"NUL_max":25699},"24":{"band":24,"FDL_low":1525,"NOffs_DL":7700,"NDL_min":7700,"NDL_max":8039,"FUL_low":1626.5,"NOffs_UL":25700,"NUL_min":25700,"NUL_max":26039},"25":{"band":25,"FDL_low":1930,"NOffs_DL":8040,"NDL_min":8040,"NDL_max":8689,"FUL_low":1850,"NOffs_UL":26040,"NUL_min":26040,"NUL_max":26689},"26":{"band":26,"FDL_low":859,"NOffs_DL":8690,"NDL_min":8690,"NDL_max":9039,"FUL_low":814,"NOffs_UL":26690,"NUL_min":26690,"NUL_max":27039},"27":{"band":27,"FDL_low":852,"NOffs_DL":9040,"NDL_min":9040,"NDL_max":9209,"FUL_low":807,"NOffs_UL":27040,"NUL_min":27040,"NUL_max":27209},"28":{"band":28,"FDL_low":758,"NOffs_DL":9210,"NDL_min":9210,"NDL_max":9659,"FUL_low":703,"NOffs_UL":27210,"NUL_min":27210,"NUL_max":27659},"31":{"band":31,"FDL_low":462.5,"NOffs_DL":9870,"NDL_min":9870,"NDL_max":9919,"FUL_low":452.5,"NOffs_UL":27760,"NUL_min":27760,"NUL_max":27809},"33":{"band":33,"FDL_low":1900,"NOffs_DL":36000,"NDL_min":36000,"NDL_max":36199,"FUL_low":1900,"NOffs_UL":36000,"NUL_min":36000,"NUL_max":36199},"34":{"band":34,"FDL_low":2010,"NOffs_DL":36200,"NDL_min":36200,"NDL_max":36349,"FUL_low":2010,"NOffs_UL":36200,"NUL_min":36200,"NUL_max":36349},"35":{"band":35,"FDL_low":1850,"NOffs_DL":36350,"NDL_min":36350,"NDL_max":36949,"FUL_low":1850,"NOffs_UL":36350,"NUL_min":36350,"NUL_max":36949},"36":{"band":36,"FDL_low":1930,"NOffs_DL":36950,"NDL_min":36950,"NDL_max":37549,"FUL_low":1930,"NOffs_UL":36950,"NUL_min":36950,"NUL_max":37549},"37":{"band":37,"FDL_low":1910,"NOffs_DL":37550,"NDL_min":37550,"NDL_max":37749,"FUL_low":1910,"NOffs_UL":37550,"NUL_min":37550,"NUL_max":37749},"38":{"band":38,"FDL_low":2570,"NOffs_DL":37750,"NDL_min":37750,"NDL_max":38249,"FUL_low":2570,"NOffs_UL":37750,"NUL_min":37750,"NUL_max":38249},"39":{"band":39,"FDL_low":1880,"NOffs_DL":38250,"NDL_min":38250,"NDL_max":38649,"FUL_low":1880,"NOffs_UL":38250,"NUL_min":38250,"NUL_max":38649},"40":{"band":40,"FDL_low":2300,"NOffs_DL":38650,"NDL_min":38650,"NDL_max":39649,"FUL_low":2300,"NOffs_UL":38650,"NUL_min":38650,"NUL_max":39649},"41":{"band":41,"FDL_low":2496,"NOffs_DL":39650,"NDL_min":39650,"NDL_max":41589,"FUL_low":2496,"NOffs_UL":39650,"NUL_min":39650,"NUL_max":41589},"42":{"band":42,"FDL_low":3400,"NOffs_DL":41590,"NDL_min":41590,"NDL_max":43589,"FUL_low":3400,"NOffs_UL":41590,"NUL_min":41590,"NUL_max":43589},"43":{"band":43,"FDL_low":3600,"NOffs_DL":43590,"NDL_min":43590,"NDL_max":45589,"FUL_low":3600,"NOffs_UL":43590,"NUL_min":43590,"NUL_max":45589},"44":{"band":44,"FDL_low":703,"NOffs_DL":45590,"NDL_min":45590,"NDL_max":46589,"FUL_low":703,"NOffs_UL":45590,"NUL_min":45590,"NUL_max":46589}}');function ce(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw a}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function fe(e){for(var t in ie){var n=ie[t];if(n.NDL_min<=+e&&n.NDL_max>=+e)return n}}function ue(e){var t=+e;if(!t.isNaN){var n=function(e){var t=fe(e);if(t)return t.band;console.warn("ArfcnUtils.getBandFromEarfcn failed , invalid earfcn :[".concat(e,"]"))}(t);if(n){var o=function(e){if("number"==typeof e){var t=fe(e);if(!t)return;var n=t.NOffs_DL,o=t.FDL_low;return void 0!==n&&void 0!==o?(e-n)/10+o:void 0}}(t);if(o){var r=function(e){if("number"==typeof e)for(var t in K){var n,o=K[t],r=ce(o.frequencyRange);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(e>=a[0]&&e<=a[1])return o}}catch(e){r.e(e)}finally{r.f()}}}(o);if(r){var a=String(r.PLMNList[0]);return{Band:String(n)||"",PLMN:a||""}}}}}}function de(){return Math.floor(268435455*Math.random())}function _e(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=ge(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){i=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(i)throw a}}}}function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],o=!0,r=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(o=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==i.return||i.return()}finally{if(r)throw a}}return n}}(e,t)||ge(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){if(e){if("string"==typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Se(e,t,n,o,r,a,s){try{var i=e[a](s),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(o,r)}function ve(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var a=e.apply(t,n);function s(e){Se(a,o,r,s,i,"next",e)}function i(e){Se(a,o,r,s,i,"throw",e)}s(void 0)}))}}function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){pe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Me(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var be=new Map,Ee=function(){function e(t){var n,o,r,a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ce(this,e),pe(this,"_initSaveProcess",(function(){a.saveProcess=setInterval((function(){a.ueListCache.length>0&&(a.ueListCache=[])}),1e3)})),pe(this,"_intervalQuery",(function(){a._cellInfo.status.value!==F&&(a.sendBaseInfoQuery(q.BOARD_TEMPERATURE),a.checkIfNeedAutoModEarfcn())})),pe(this,"getCellInfo",(function(){return a._cellInfo})),pe(this,"_updateCellInfo",(function(e){if(console.debug("".concat(a.host," updating cellInfos:"),JSON.stringify(e)),e){var t=!1;for(var n in e)if(a._cellInfo.hasOwnProperty(n))if(Array.isArray(e[n])&&Array.isArray(a._cellInfo[n]))a._cellInfo[n]=e[n],t=!0;else if("Frame"===n||"Bandwidth"===n||"status"===n)e[n].value!==a._cellInfo[n].value&&(a._cellInfo[n]=e[n],t=!0);else if("BandPwrdereaseMap"===n){var o=e[n];for(var r in o)if(o[r]!==a._cellInfo[n][r]){a._cellInfo[n]=o,t=!0;break}}else if("object"===Le(e[n])){var s=e[n];for(var i in s)s[i]!==a._cellInfo[n][i]&&(a._cellInfo[n][i]=s[i],t=!0)}else e[n]!==a._cellInfo[n]&&(a._cellInfo[n]=e[n],t=!0);else console.error("LteController._updateCellInfo get invalid key[".concat(n,"] in info:[").concat(e,"]"));t&&console.debug("client [".concat(a.host,"] updated info is :[").concat(JSON.stringify(a._cellInfo),"]"))}else console.error("LTEComtroller._updateCellInfo :client [".concat(a.host,"] recv invalid info: ").concat(e))})),this._lteClient=void 0,this._lteProto=new T,this.host=t,this.cacheMsg=new Map,this.cacheBuff=Buffer.allocUnsafe(0),this.ueListCache=[],this.saveProcess=void 0,this._SubSysCode=0,this.autoModEarfcnProcess=setInterval,this.temperatureAlertTimes75=0,this._cellInfo={Frame:Q.get(V),Band:NaN,settingCellInfo:{ulEarfcn:0,dlEarfcn:0,Band:0,PLMN:0,CellId:0,UePMax:0},ulEarfcn:NaN,dlEarfcn:NaN,PLMN:"",SOFTWARE_VERSION:"",Bandwidth:B.get(k),PCI:NaN,RxGainValueFromReg:0,RxGainValueFromMib:NaN,Pwr1Derease:0,PowerDereaseValueFromReg:NaN,PowerDereaseValueFromMib:NaN,AgcFlag:NaN,SnfRxGainValueFromReg:NaN,SnfRxGainValueFromMib:NaN,RxOrSnfFlag:0,dlEarfcnList:[],blackControlList:[],whiteControlList:[],earfcnAutoModing:!1,modInterval:5,locationIMSI:"",boardTemperature:0,bandPwrdereaseMap:{},MeasUECfg:{WorkMode:0,RedirectSubMode:4,CapturePeriod:5,IMSI:"",MeasReportPeriod:3,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:0,SrsSwitch:0,ControlSubMode:0},measValueClosed:146,measValueAttK:-.34,measValueFar:95,farDistance:150,status:D.get(F)},this._updateCellInfo(Ne(Ne({},s),{},{status:D.get(F)})),this._initSaveProcess(),this.cbMap={},this.initCheckCBMap(),this._airSyncFailedRetryTimes=2,this._nearbyEarfcnMap=(pe(r={},j,(pe(n={},K.CMCC.key,[]),pe(n,K.CTCC.key,[]),pe(n,K.CUCC.key,[]),n)),pe(r,V,(pe(o={},K.CMCC.key,[]),pe(o,K.CTCC.key,[]),pe(o,K.CUCC.key,[]),o)),r),this._latestMeasInfo={}}var t,n,o,r;return t=e,(n=[{key:"checkIfNeedAutoModEarfcn",value:function(){}},{key:"initClient",value:function(e){var t=this;this._lteClient?console.log("lte client [".concat(this.host,"] reconnected")):console.log("lte client [".concat(this.host,"] connected")),this._lteClient=e,this._lteClient.registerHandler("data",this.handMsg.bind(this)),this._lteClient.registerHandler("error",(function(e){e&&(console.error("lte controller [".concat(t.host,"] got error:").concat(e)),t._lteClient.destroy())})),this._lteClient.registerHandler("close",(function(){t.updateStatus(F),console.warn("lte controller [".concat(t.host,"] disconnected"))})),this._lteClient.registerHandler("timeout",(function(){t.updateStatus(F),console.warn("lte controller [".concat(t.host,"] timeout")),t._lteClient.destroy()}))}},{key:"initQuery",value:function(){var e=this,t=[this.sendPowerDereaseQuery,this.sendMeasUECfgQuery,this.sendMultiBandPowerdereaseQuery,function(){e.sendControlListQuery(0)},function(){e.sendControlListQuery(1)},function(){e.sendSysRxGainCfg(42,1,0)},function(){e.sendBaseInfoQuery(q.SOFTWARE_VERSION)}];this._cellInfo.earfcnAutoModing&&t.push(this.startAutoModEarfcn);for(var n=function(n){setTimeout((function(){t[n].call(e)}),500*n)},o=0;o<t.length;o+=1)n(o)}},{key:"updateStatus",value:function(e){var t=this._cellInfo.status;t.value!==e?D.has(e)?(this._cellInfo.status.value===F&&e!==F&&this.initQuery(),this._cellInfo.status=D.get(e),console.log("lte status changed from [".concat(t.text,"] to [").concat(this._cellInfo.status.text,"]"))):console.error("LTEControllers.updateStatus invalid arguments :".concat(e)):console.debug("current state is ".concat(t.text,", not changed"))}},{key:"registerCB",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=o.cfgMsgType,a=o.ackMsgType,s=o.timeout,i=o.doNotNeedCommonHandle,c="".concat(e,"_").concat(t);this.cbMap[c]&&console.warn("[".concat(this.host,"] 已存在").concat(c,"对应的回调函数")),this.cbMap[c]={cb:n,time:oe()().unix(),cfgMsgType:r,ackMsgType:a,timeout:s,doNotNeedCommonHandle:i},console.log("[".concat(this.host,"]注册事件 key:[").concat(c,"] info:").concat(JSON.stringify(this.cbMap[c])))}},{key:"registerCBAsync",value:(r=ve(regeneratorRuntime.mark((function e(t,n){var o,r=this,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",new Promise((function(e){r.registerCB(t,n,(function(t,n){e([t,n])}),o)})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"_activateCB",value:function(e,t,n,o){var r=o.headObj,a=o.bodyObj,s="".concat(e,"_").concat(t);if(this.cbMap[s]){console.log("[".concat(this.host,"] 触发回调事件 ").concat(s)),this.cbMap[s].cb(n,{headObj:r,bodyObj:a});var i=this.cbMap[s].doNotNeedCommonHandle;return delete this.cbMap[s],i}return!1}},{key:"initCheckCBMap",value:function(){var e=this;setInterval((function(){for(var t in e.cbMap){var n=e.cbMap[t],o=n.cb,r=n.timeout,a=n.time;oe()().unix()-a>(r||10)&&(console.warn("[".concat(e.host,"]: callback ").concat(t," timeout")),o("[".concat(e.host,"]: callback ").concat(t," timeout")),console.log("clear lte callback ".concat(e.host," key:[").concat(t,"] now:[").concat(oe()().unix(),"] start:[").concat(a,"]")),delete e.cbMap[t])}}),1e3)}},{key:"handMsg",value:function(e){var t,n=[];if(Buffer.isBuffer(e)){console.debug("[".concat(this.host,"] recv msg,buffer:").concat(e.toString("hex"))),this.cacheBuff=Buffer.concat([this.cacheBuff,e]);try{for(var o=0;this.cacheBuff.length>=this._lteProto.HEAD_LENGTH;){o+=1;var r=this.cacheBuff.slice(0,this._lteProto.HEAD_LENGTH),a=this._lteProto.HEAD.getObj(r);console.debug("[".concat(this.host,"] head parsed"),JSON.stringify(a)),this._SubSysCode=a.SubSysCode,a.Frame!==this._cellInfo.Frame.value&&Q.has(a.Frame)&&this._updateCellInfo({Frame:Q.get(a.Frame)});var s=a.SubSysCode>>>15,i=32767&a.SubSysCode;a.transID=i,a.ifCompelte=s;var c=this.cacheBuff.slice(this._lteProto.HEAD_LENGTH,a.MsgLength);console.debug("[".concat(this.host,"] slice data ,headBuf:").concat(r.toString("hex"),",body buffer:").concat(c.toString("hex"))),1!==s?(this.cacheMsg.has(i)&&(c=Buffer.concat([].concat(function(e){if(Array.isArray(e))return ye(e)}(t=this.cacheMsg.get(i))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||ge(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[c])),console.debug("[".concat(this.host,"] 分包处理完毕, bodyBuf 合体 ").concat(c.toString("hex"))),this.cacheMsg.delete(i)),this.cacheBuff=this.cacheBuff.slice(a.MsgLength),this.cacheBuff.length>0&&console.debug("[".concat(this.host,"] 粘包了 剩余buffer ").concat(this.cacheBuff.toString("hex"))),n.push(a),this._parseBody(a,c)):(i+=1,console.log("[".concat(this.host,"] 收到分包消息，tranID:").concat(i)),this.cacheMsg.has(i)?this.cacheMsg.get(i).push(c):this.cacheMsg.set(i,[c]),this.cacheBuff=this.cacheBuff.slice(a.MsgLength))}console.debug("parsed msg in ".concat(o," times")),this.cacheBuff.length>0&&(console.debug("[".concat(this.host,"] 粘包处理完了 还剩buffer？ ").concat(this.cacheBuff.toString("hex"))),this.cacheBuff=Buffer.allocUnsafe(0))}catch(e){e&&(console.error("parse msg from lte client[".concat(this.host,"] run error ,err:[").concat(e,"],msg buffer:[").concat(this.cacheBuff.toString("hex"),"] headList:").concat(JSON.stringify(n))),this.cacheMsg=new Map)}}else console.error("recv data is not buffer ,data:".concat(e))}},{key:"_parseBody",value:function(e,t){var n=e.MsgType,o=this._lteProto.getBodyStruct(n);if(o){var r=o.getObj(t);if(console.debug("[".concat(this.host,"] parsed msg ,headObj:").concat(JSON.stringify(e),",bodyObj:").concat(JSON.stringify(r))),!this._activateCB(1,e.MsgType,null,{headObj:e,bodyObj:r}))switch(n){case 61456:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_INIT_SUCC_IND],body:".concat(JSON.stringify(r))),this._handleSysInitSuccInd(e,r);break;case 61444:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_ARFCN_ACK],body:".concat(JSON.stringify(r))),this._handSysArfcnAck(e,r);break;case 61445:console.debug("recv msg type:[O_FL_ENB_TO_LMT_UE_INFO_RPT],body:".concat(JSON.stringify(r))),this._handleUeInfoPrt(e,r);break;case 61454:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SET_ADMIN_STATE_ACK],body:".concat(JSON.stringify(r))),this._handSetAdminStateAck(e,r);break;case 61465:console.debug("recv msg type:[O_FL_ENB_TO_LMT_ENB_STATE_IND],body:".concat(JSON.stringify(r))),this._handEnbStateInd(e,r);break;case 61490:console.debug("recv msg type:[O_FL_ENB_TO_LMT_RXGAIN_POWER_DEREASE_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handlePowerDereaseQueryAck(e,r);break;case 61462:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_PWR1_DEREASE_ACK],body:".concat(JSON.stringify(r))),this._handlePwr1DereaseAck(e,r);break;case 61447:console.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_UE_ACK],body:".concat(JSON.stringify(r))),this._handleMeasUEAck(e,r);break;case 61502:console.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_UE_CFG_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handleMeasUECfgQueryAck(e,r);break;case 61448:console.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_INFO_RPT],body:".concat(JSON.stringify(r))),this._handleMeasInfoPrt(e,r);break;case O:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_MODE_ACK],body:".concat(JSON.stringify(r))),this._handleSysModeAck(e,r);break;case 61488:console.debug("recv msg type:[O_FL_ENB_TO_LMT_CELL_STATE_INFO_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handleCellStateInfoQueryAck(e,r);break;case 61569:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_ARFCN_MOD_ACK],body:".concat(JSON.stringify(r))),this._handleEarfcnModAck(e,r);break;case 61484:console.debug("recv msg type:[O_FL_ENB_TO_LMT_BASE_INFO_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handleBaseInfoQueryAck(e,r);break;case R:console.debug("recv msg type:[O_FL_ENB_TO_LMT_REBOOT_ACK],body:".concat(JSON.stringify(r))),this._handleRebootAck(e,r);break;case 61610:console.debug("recv msg type:[O_FL_ENB_TO_LMT_MULTI_BAND_POWERDEREASE_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handleMultiBandPowerdereaseQueryAck(e,r);break;case 61460:console.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_RxGAIN_ACK],body:".concat(JSON.stringify(r))),this._handleSysRxGainCfgAck(e,r);break;case 61520:console.debug("recv msg type:[O_FL_LMT_TO_ENB_SELFCFG_CELLPARA_REQ_ACK],body:".concat(JSON.stringify(r))),this._handleSelfCfgCellParaReqAck(e,r);break;case 61450:console.debug("recv msg type:[O_FL_ENB_TO_LMT_REM_INFO_RPT],body:".concat(JSON.stringify(r))),this._handleRemInfoPrt(e,r);break;case 61498:console.debug("recv msg type:[O_FL_ENB_TO_LMT_CONTROL_UE_LIST_CFG_ACK],body:".concat(JSON.stringify(r))),this._handleControlUEListCfgAck(e,r);break;case 61508:console.debug("recv msg type:[O_FL_ENB_TO_LMT_CONTROL_LIST_QUERY_ACK],body:".concat(JSON.stringify(r))),this._handleControlListQueryAck(e,r)}}else console.warn("cannot support this msg type [".concat(n,"]"))}},{key:"packAndSendMsg",value:function(e,t){if(!this._cellInfo.earfcnAutoModing||!W.includes(e)){var n;n=t?this._lteProto.getBodyStruct(e).getBuff(t):Buffer.from([]);var o={FrameHeader:1431677610,MsgType:e,MsgLength:this._lteProto.HEAD_LENGTH+n.length,Frame:this._cellInfo.Frame.value,SubSysCode:this._SubSysCode+=1};return console.debug("lte server send msg to client [".concat(this.host,",head:").concat(JSON.stringify(o),",body:").concat(JSON.stringify(t))),this._sendData(Buffer.concat([this._lteProto.HEAD.getBuff(o),n],this._lteProto.HEAD_LENGTH+n.length))?o:void 0}console.log("client [".concat(this.host,"] auto modify earfcn, if you want use other command , stop it first"))}},{key:"_handleMeasInfoPrt",value:function(e,t){var n=t.IMSI,o=t.UeMeasValue,r=t.ProtocolVer;n===this._cellInfo.locationIMSI&&this._cellInfo.earfcnAutoModing&&this.stopAutoModEarfcn();var a=o;this._cellInfo.Frame.value===j&&(a=o+54),this._latestMeasInfo={host:this.host,IMSI:n,UeMeasValue:a,ProtocolVer:r,prtTime:oe()().format(re),earfcn:this._cellInfo.dlEarfcn||"未知"}}},{key:"_handleSysInitSuccInd",value:function(e,t){this._intervalQuery();var n=t.CellState,o=t.Band,r=t.ulEarfcn,a=t.dlEarfcn,s=t.PLMN,i=t.Bandwidth,c=t.PCI;void 0!==n?65535===n?this.updateStatus(0):(this.updateStatus(n),65535!==o&&4294967295!==r&&4294967295!==a&&65535!==c&&255!==i&&this._updateCellInfo({Band:o,ulEarfcn:r,dlEarfcn:a,PLMN:s,Bandwidth:B.get(i),PCI:c})):console.log("cannot get CellState from SysInitSuccInd Msg body"),this.sendSysInitSuccRsp()}},{key:"_handSysArfcnAck",value:function(e,t){if(0===t.CfgResult){this.updateStatus(2);var n=this._cellInfo.settingCellInfo,o=n.dlEarfcn,r=n.ulEarfcn,a=n.Band,s=n.PLMN;o&&a&&this._updateCellInfo({dlEarfcn:o,ulEarfcn:r,Band:a,PLMN:s,settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}else this._cellInfo.settingCellInfo&&this._updateCellInfo({settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}},{key:"_handSetAdminStateAck",value:function(e,t){t.CfgResult}},{key:"_handEnbStateInd",value:function(e,t){var n=t.CellStateInd;if(n){var o=x.get(n);this.updateStatus(o.CellState),6===n&&this.sendPwr1DereaseCfg({Pwr1Derease:this._cellInfo.Pwr1Derease||0,IsSave:1}),4===n&&console.debug("device ".concat(this.host," scan net succ")),1===n&&(this._airSyncFailedRetryTimes>0?(this.activateLTEWithLastCellInfo(),this._airSyncFailedRetryTimes-=1):this._airSyncFailedRetryTimes=2)}}},{key:"_handleUeInfoPrt",value:function(e,t){if(t){var n=t.IMSI,o=t.IMEI,r=t.RSSI,a=oe()().format(re);this.ueListCache.push({IMSI:n,IMEI:o,RSSI:r,prtTime:a,deviceHost:this.host})}}},{key:"_handlePowerDereaseQueryAck",value:function(e,t){var n=t.RxGainValueFromReg,o=t.RxGainValueFromMib,r=t.PowerDereaseValueFromReg,a=t.PowerDereaseValueFromMib;this._updateCellInfo({Pwr1Derease:r-(this._cellInfo.bandPwrdereaseMap[this._cellInfo.Band]||0),RxGainValueFromReg:n,RxGainValueFromMib:o,PowerDereaseValueFromReg:r,PowerDereaseValueFromMib:a})}},{key:"sendPwr1DereaseCfg",value:function(e){var t=e.Pwr1Derease,n=e.IsSave,o=this._cellInfo.bandPwrdereaseMap[this._cellInfo.Band]||0;console.log("device[".concat(this.host,"] prePwr1Derease is "),o),void 0!==t&&void 0!==n?this.packAndSendMsg(61461,{Pwr1Derease:t+o,IsSave:n?1:0}):console.error("LTEController.sendPwr1DereaseCfg recv invalid data:".concat(JSON.stringify(e)))}},{key:"_handlePwr1DereaseAck",value:function(e,t){t.CfgResult,this.sendPowerDereaseQuery()}},{key:"_handleMeasUEAck",value:function(e,t){0===t.CfgResult&&this.sendMeasUECfgQuery()}},{key:"sendMeasUECfgQuery",value:function(){this.packAndSendMsg(61501,void 0)}},{key:"_handleMeasUECfgQueryAck",value:function(e,t){var n=t.WorkMode,o=t.RedirectSubMode,r=t.CapturePeriod,a=t.IMSI,s=t.MeasReportPeriod,i=t.SchdUeMaxPowerTxFlag,c=t.SchdUeMaxPowerValue,l=t.SchdUeUlFixedPrbSwitch,f=t.CampOnAllowedFlag,u=t.SrsSwitch,d=t.ControlSubMode;this._updateCellInfo({MeasUECfg:{WorkMode:n,RedirectSubMode:o,CapturePeriod:r,IMSI:a,MeasReportPeriod:s,SchdUeMaxPowerTxFlag:i,SchdUeMaxPowerValue:c,SchdUeUlFixedPrbSwitch:l,CampOnAllowedFlag:f,SrsSwitch:u,ControlSubMode:d}})}},{key:"sendSysInitSuccRsp",value:function(){this.packAndSendMsg(61457,void 0)}},{key:"sendSycArfcnCfg",value:function(e){var t=e.dlEarfcn,n=e.PLMN,o=e.Bandwidth,r=e.Band,a=e.PCI,s=e.TAC,i=e.CellId,c=se[this.host];if(c&&-1===c.indexOf(r))setTimeout((function(){}),1e3);else if(t&&n&&o&&r&&void 0!==a&&void 0!==s&&void 0!==i){var l=Y(t,this._cellInfo.Frame.value),f={ulEarfcn:l,dlEarfcn:t,PLMN:n,Bandwidth:25,Band:r,PCI:a,TAC:s,CellId:i,UePMax:23,EnodeBPMax:20};this.packAndSendMsg(w,f),this.updateStatus(2),this._updateCellInfo({settingCellInfo:{dlEarfcn:t,ulEarfcn:l,Band:r,CellId:i,PLMN:n,UePMax:23}})}else console.error("invalid input arguments, ServingCellCfgInfo:".concat(JSON.stringify(e)))}},{key:"sendSetAdminStateCfg",value:function(e){0!==e&&1!==e&&2!==e||(this.packAndSendMsg(P,{workAdminState:e}),0===e?this.updateStatus(4):this.updateStatus(2))}},{key:"sendPowerDereaseQuery",value:function(){this.packAndSendMsg(61489,void 0)}},{key:"sendGetArfcn",value:function(){this.packAndSendMsg(61479,void 0)}},{key:"sendSysModeCfg",value:function(e){var t=e.sysMode;return void 0!==t?this.packAndSendMsg(I,{sysMode:t}):(console.warn("sendSysModeCfg invalid arguments :".concat(JSON.stringify(e))),null)}},{key:"sendSysModeCfgAsync",value:function(e){var t=this;return new Promise(function(){var n=ve(regeneratorRuntime.mark((function n(o){var r,a,s,i,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.sendSysModeCfg(e)){n.next=4;break}return o(["send failed"]),n.abrupt("return");case 4:return n.next=6,t.registerCBAsync(1,O,{doNotNeedCommonHandle:!0});case 6:if(r=n.sent,a=he(r,2),s=a[0],i=a[1],!s){n.next=13;break}return o([s]),n.abrupt("return");case 13:(c=i.bodyObj)&&0===c.CfgResult?o([null]):o(["cfg failed, err = ".concat(c.CfgResult)]);case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"activateLTEWithLastCellInfo",value:function(){var e=this._cellInfo,t=e.dlEarfcn,n=e.PLMN,o=e.Bandwidth,r=e.Band,a=e.PCI,s={dlEarfcn:t,PLMN:n,Bandwidth:o.value,Band:r,PCI:a,TAC:Math.floor(65535*Math.random()),CellId:de()};this.sendSycArfcnCfg(s)}},{key:"_handleSysModeAck",value:function(e,t){t.CfgResult}},{key:"sendMeasUECfg",value:function(e,t){var n=Ne({WorkMode:0,RedirectSubMode:4,CapturePeriod:5,IMSI:"",MeasReportPeriod:3,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:0,SrsSwitch:0,Res:0,ControlSubMode:0,Res1:[0,0,0]},this._cellInfo.MeasUECfg),o=!1;if(void 0===e)o=!0;else switch(n.WorkMode=e,e){case 0:break;case 1:var r=t.CapturePeriod;void 0!==r&&(n.CapturePeriod=r);break;case 2:var a=t.IMSI,s=t.MeasReportPeriod,i=t.SchdUeMaxPowerValue,c=t.SchdUeUlFixedPrbSwitch,l=t.CampOnAllowedFlag,f=t.SchdUeMaxPowerTxFlag,u=t.SrsSwitch;void 0!==a&&void 0!==s&&void 0!==i&&void 0!==c&&void 0!==l&&void 0!==u&&(n=Ne(Ne({},n),{},{IMSI:a,MeasReportPeriod:s,SchdUeMaxPowerTxFlag:f,SchdUeMaxPowerValue:i,SchdUeUlFixedPrbSwitch:c,CampOnAllowedFlag:l,SrsSwitch:u}),this._updateCellInfo({locationIMSI:a}));break;case 3:var d=t.ControlSubMode;void 0!==d&&(n.ControlSubMode=d);break;case 4:var _=t.RedirectSubMode;void 0!==_&&(n.RedirectSubMode=_)}o?console.error("LTEController.sendMeasUECfg invalid options:".concat(JSON.stringify(t)," ,workMode:").concat(e)):this.packAndSendMsg(U,n)}},{key:"setLocateIMSI",value:function(e){this.sendMeasUECfg(2,{WorkMode:2,IMSI:e,MeasReportPeriod:4,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:1,SrsSwitch:0})}},{key:"sendCellStateInfoQuery",value:function(){this.packAndSendMsg(61487,void 0)}},{key:"_handleCellStateInfoQueryAck",value:function(e,t){var n=t.CellState;this.updateStatus(n)}},{key:"sendEarfcnMod",value:function(e){if(e&&Number.isInteger(e)){var t=ue(e);if(!t)return;var n=+t.Band,o=t.PLMN,r=Y(e,this._cellInfo.Frame.value),a=de();this._updateCellInfo({settingCellInfo:{dlEarfcn:e,ulEarfcn:r,Band:n,CellId:a,PLMN:o,UePMax:23}}),this.packAndSendMsg(61568,{ulEarfcn:r,dlEarfcn:e,Band:n,PLMN:o,CellId:a,UePMax:23})}}},{key:"sendBaseInfoQuery",value:function(e){e in Object.values(q)?this.packAndSendMsg(61483,{EnbBaseInfoType:e}):console.error("Invalid EnbBaseInfoType")}},{key:"_handleBaseInfoQueryAck",value:function(e,t){var n=t.EnbBaseInfoType,o=t.EnbBaseInfo;switch(console.log(JSON.stringify(t)),n){case q.DEVICE_MODEL:case q.HARDWARE_VERSION:break;case q.SOFTWARE_VERSION:this._updateCellInfo({SOFTWARE_VERSION:o});break;case q.BOARDSN:case q.MAC:break;case q.BOARD_TEMPERATURE:var r=Math.round(+o);r&&(this._updateCellInfo({boardTemperature:r}),r>=75?(this.temperatureAlertTimes75,this.temperatureAlertTimes75+=1):this.temperatureAlertTimes75=0)}}},{key:"_handleEarfcnModAck",value:function(e,t){if(0===t.CfgResult){var n=this._cellInfo.settingCellInfo,o=n.dlEarfcn,r=n.ulEarfcn,a=n.Band,s=n.PLMN;o&&a&&this._updateCellInfo({dlEarfcn:o,ulEarfcn:r,Band:a,PLMN:s,settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}}),this.sendPwr1DereaseCfg({Pwr1Derease:this._cellInfo.Pwr1Derease,IsSave:1})}else this._cellInfo.settingCellInfo&&this._updateCellInfo({settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}},{key:"sendRebootCfg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.packAndSendMsg(A,{SelfActiveCfg:e})}},{key:"sendRebootCfgAsync",value:function(e){var t=this;return new Promise(function(){var n=ve(regeneratorRuntime.mark((function n(o){var r,a,s,i,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.sendRebootCfg(e)){n.next=4;break}return o(["send failed"]),n.abrupt("return");case 4:return n.next=6,t.registerCBAsync(1,R);case 6:if(r=n.sent,a=he(r,2),s=a[0],i=a[1],!s){n.next=13;break}return o([s]),n.abrupt("return");case 13:0===(c=i.bodyObj).CfgResult?o([null]):o(["sendRebootCfgAsync failed, err = ".concat(c.CfgResult)]);case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_handleRebootAck",value:function(e,t){t.CfgResult}},{key:"sendMultiBandPowerdereaseQuery",value:function(){this.packAndSendMsg(61609,void 0)}},{key:"_handleMultiBandPowerdereaseQueryAck",value:function(e,t){var n=t.NumElem,o=t.bandPwrdereaseMap,r={};for(var a in o){if(+a>n)break;var s=o[a],i=s.band,c=s.Pwrderease;r[i]=c}console.log("device [".concat(this.host,"] bandPwrdereaseMap is "),JSON.stringify(r)),this._updateCellInfo({bandPwrdereaseMap:r})}},{key:"setModEarfcnInfo",value:function(e,t){if(e&&Array.isArray(e)&&t&&Number.isInteger(t)){var n=se[this.host];if(n){var o,r=_e(e);try{for(r.s();!(o=r.n()).done;){var a=o.value;if(a){var s=ue(a);if(!s||-1===n.indexOf(+s.Band))return}}}catch(e){r.e(e)}finally{r.f()}}t!==this._cellInfo.modInterval&&this._cellInfo.earfcnAutoModing&&this.startAutoModEarfcn(),this._updateCellInfo({dlEarfcnList:e,modInterval:t})}else console.error("LTEController.setModEarfcnInfo invalid arguments,arg:".concat(JSON.stringify({earfcnList:e,interval:t})))}},{key:"_getNextEarfcnToMod",value:function(){var e=this._cellInfo,t=e.dlEarfcnList,n=e.dlEarfcn,o=t.indexOf(n);return-1===o||o===t.length-1?t[0]:t[o+1]}},{key:"startAutoModEarfcn",value:function(){var e=this;0!==this._cellInfo.dlEarfcnList.length?3===this._cellInfo.status.value?(this._cellInfo.earfcnAutoModing&&this.autoModEarfcnProcess&&clearInterval(this.autoModEarfcnProcess),this.autoModEarfcnProcess=setInterval((function(){if(3===e._cellInfo.status.value){var t=e._getNextEarfcnToMod();console.log("device [".concat(e.host,"] auto mod earfcn from [").concat(e._cellInfo.dlEarfcn,"] to [").concat(t,"]")),e.sendEarfcnMod(t)}else e.stopAutoModEarfcn()}),1e3*this._cellInfo.modInterval),this._updateCellInfo({earfcnAutoModing:!0})):this._updateCellInfo({earfcnAutoModing:!1}):console.warn("device [".concat(this.host,"] has no dlEarfcnList, please add first"))}},{key:"stopAutoModEarfcn",value:function(){this.autoModEarfcnProcess&&clearInterval(this.autoModEarfcnProcess),this._updateCellInfo({earfcnAutoModing:!1})}},{key:"_sendData",value:function(e){var t=this;if(this._cellInfo.status.value!==F)if(Buffer.isBuffer(e)){if(this._lteClient)return this._lteClient.sendData(e,(function(){console.debug("send data to client [".concat(t.host,"] successfully , buffer:").concat(e.toString("hex")))})),!0}else console.warn("you are trying to send invalid type , buffer:".concat(JSON.stringify(e)));else console.warn("client [".concat(this.host,"] disconnected, cannot send data to client"))}},{key:"setMeasUnitInfo",value:function(e,t,n){var o=(t-e)/n;console.log("device [".concat(this.host,"] setMeasUnitInfo ").concat(JSON.stringify({measValueClosed:e,measValueFar:t,farDistance:n,measValueAttK:o}),":")),this._updateCellInfo({measValueClosed:e,measValueFar:t,farDistance:n,measValueAttK:o})}},{key:"sendSysRxGainCfg",value:function(e,t,n){var o={RxGain:e,RxGainSaveFlag:t?1:0,RxOrSnfFlag:n};this._updateCellInfo({RxOrSnfFlag:o.RxOrSnfFlag}),console.log(JSON.stringify(o)),this.packAndSendMsg(61459,o)}},{key:"_handleSysRxGainCfgAck",value:function(e,t){0===t.CfgResult&&this.sendPowerDereaseQuery()}},{key:"sendSelfCfgCellParaReq",value:function(e){var t={SelfBand:e};this.packAndSendMsg(61519,t)}},{key:"_handleSelfCfgCellParaReqAck",value:function(e,t){t.CfgResult}},{key:"activateWithScanNetResult",value:function(e){this._cellInfo.Frame.value===j?this.sendSelfCfgCellParaReq(255):e&&e.dlEarfcn&&this.sendSycArfcnCfg(e)}},{key:"sendRemCfg",value:function(e){var t,n,o=e.wholeBandRem,r=e.sysEarfcnList,a=r.length>0?r:(t=this.host,n=this._cellInfo.Frame.value,t.includes("2.53")?n===j?[38400,38544,36275]:[1650,1825,1850,1307]:t.includes("2.54")?n===j?[37900,38098,38950,39148,40738,40940,39450,38750]:[100,2452,3650,3515]:[]);console.log("准备启动扫网 目标频点列表 ".concat(a));var s={wholeBandRem:o?1:0,sysEarfcnNum:a.length,sysEarfcn:a};this.packAndSendMsg(61449,s)}},{key:"_handleRemInfoPrt",value:function(e,t){console.log("[".concat(this.host,"] 准备处理扫网信息"),0===t.collectionTypeFlag,JSON.stringify(t)),0===t.collectionTypeFlag||console.log("[".concat(this.host,"] 收到同步扫频消息"))}},{key:"sendControlUEListCfg",value:function(e){var t=e.ControlMovement,n=e.ControlUEProperty,o=e.ControlUEIdentity,r=e.ClearType,a=void 0===r?0:r,s=e.RejCause,i=void 0===s?0:s;if(o&&0!==o.length){var c={ControlUEProperty:n,ControlMovement:t,ControlUENum:o.length,ControlUEIdentity:o,ClearType:a,RejCause:i,Res:[]};this.packAndSendMsg(61497,c)}}},{key:"_handleControlUEListCfgAck",value:function(e,t){t.CfgResult;var n=t.IgnoreUENum,o=t.IgnoreUEList,r=void 0===o?[]:o;"存在".concat(n,"个用户未删除成功 [").concat(r.join(","),"]"),"存在".concat(n,"个用户未添加成功 [").concat(r.join(","),"]"),this.initQuery()}},{key:"sendControlListQuery",value:function(e){this.packAndSendMsg(61507,{ControlListType:e,Res:[]})}},{key:"_handleControlListQueryAck",value:function(e,t){var n=t.ControlListProperty,o=t.ControlListUEId;0===n?this._updateCellInfo({blackControlList:o}):this._updateCellInfo({whiteControlList:o})}},{key:"syncControlList",value:(o=ve(regeneratorRuntime.mark((function e(t,n){var o,r,a,s,i,c,l,f,u,d,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:[],o=0===t?this._cellInfo.blackControlList:this._cellInfo.whiteControlList,r=new Set(o),a=new Set(n),s=new Set,i=new Set,c=_e(n);try{for(c.s();!(l=c.n()).done;)f=l.value,!r.has(f)&&s.size<10&&s.add(f)}catch(e){c.e(e)}finally{c.f()}u=_e(o);try{for(u.s();!(d=u.n()).done;)_=d.value,!a.has(_)&&i.size<10&&i.add(_)}catch(e){u.e(e)}finally{u.f()}if(!(s.size>0)){e.next=13;break}return e.next=13,this.sendControlUEListCfg({ControlUEProperty:t,ControlMovement:1,ControlUEIdentity:Array.from(s)});case 13:i.size>0&&this.sendControlUEListCfg({ControlUEProperty:t,ControlMovement:0,ControlUEIdentity:Array.from(i)});case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"changeSysModeAync",value:function(e){var t=this;return new Promise(function(){var n=ve(regeneratorRuntime.mark((function n(o){var r,a,s,i,c,l,f,u,d;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("".concat(t.host," Step: 切换模式中 target mode").concat(Q.get(e).text)),e!==t._cellInfo.Frame.value){n.next=4;break}return o([null]),n.abrupt("return");case 4:return r={sysMode:0},e===V&&(r.sysMode=1),n.next=8,t.sendSysModeCfgAsync(r);case 8:if(a=n.sent,s=he(a,1),!(i=s[0])){n.next=14;break}return o([i]),n.abrupt("return");case 14:return console.log("".concat(t.host," Step: 切换模式配置成功")),n.next=17,t.sendRebootCfgAsync();case 17:if(c=n.sent,l=he(c,1),!(f=l[0])){n.next=23;break}return o([f]),n.abrupt("return");case 23:console.log("".concat(t.host," Step: 重启配置成功")),u=0,d=setInterval((function(){return u>240?(console.log("".concat(t.host," Step: 切换模式超时 ").concat(t._cellInfo.Frame.text)),o(["changeSysModeAync timeout"]),void clearInterval(d)):(console.log("".concat(t.host," Step: 切换模式中 target mode").concat(Q.get(e).text)),e===t._cellInfo.Frame.value?(o([null]),console.log("".concat(t.host," Step: 切换模式成功 current mode").concat(t._cellInfo.Frame.text)),void clearInterval(d)):void(u+=1))}),1e3);case 26:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"setNearbyEarfcnMap",value:function(e,t){this._nearbyEarfcnMap[e]=t}},{key:"getNearbyEarfcnMap",value:function(e){return this._nearbyEarfcnMap[e]}}])&&Me(t.prototype,n),e}();function Ie(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Oe=new Map,we=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._iotClient=void 0,this.host=t,this._status=te.get(0),this._cacheBuff=Buffer.allocUnsafe(0),this._iotProto=new ee,this.autoUpdateClock=NaN,this._iotInfo={fanSpeed:0,batteryVoltage:100}}var t,n;return t=e,(n=[{key:"startUpdateIotInfo",value:function(){var e=this;console.log("iot ctl start query"),this.autoUpdateClock=setInterval((function(){e.queryBatteryVoltage(),e.queryFanSpeed()}),3e3)}},{key:"stopUpdateIotInfo",value:function(){Number.isNaN(this.autoUpdateClock)||(console.log("iot ctl stop query"),clearInterval(this.autoUpdateClock))}},{key:"getIotInfo",value:function(){return this._iotInfo}},{key:"_updateIotInfo",value:function(e){if(e){var t=!1;for(var n in e)if(n){var o=e[n];this._iotInfo[n]!==o&&(this._iotInfo[n]=o,t=!0)}t&&console.log("iot info has changed,changed info : [".concat(JSON.stringify(this._iotInfo),"]"))}}},{key:"updateStatus",value:function(e){if(te.has(e)){0===e&&this.stopUpdateIotInfo(),1===e&&this.startUpdateIotInfo();var t=this._status;this._status=te.get(e),console.log("iot controller status changed from [".concat(t.text,"] to [").concat(this._status.text,"]"))}else console.warn("IotCtl.updateStatus invalid status:[".concat(e,"]"))}},{key:"handleMsg",value:function(e){if(Buffer.isBuffer(e))for(console.debug("recv msg from [".concat(this.host,"],buffer:").concat(e.toString("hex"))),this._cacheBuff=Buffer.concat([this._cacheBuff,e]);this._cacheBuff.length>=this._iotProto.HEAD_LEN+this._iotProto.END_LEN;){var t=e.slice(0,this._iotProto.HEAD_LEN),n=this._iotProto.HEAD_STRUCT.getObj(t),o=e.slice(this._iotProto.HEAD_LEN,this._iotProto.HEAD_LEN+n.contentLength);console.debug("recv data ,head:".concat(JSON.stringify(n),",body buffer:").concat(o.toString("hex"))),this._cacheBuff=this._cacheBuff.slice(n.contentLength+this._iotProto.HEAD_LEN+this._iotProto.END_LEN),this._parseBody(n,o)}else console.error("recv data from iot client is not buffer ,data:".concat(e))}},{key:"sendMsg",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t){var o;o=1===t?this._iotProto.getBodyStruct(e).getBuff(n):this._iotProto.IOT_COMMON_QUERY.getBuff();var r=this._iotProto.HEAD_STRUCT.getBuff({fixHead:$,funCode:e,cmd:t,contentLength:o.length}),a=this._iotProto.END_STRUCT.getBuff({fixEnd:126}),s=Buffer.concat([r,o,a]);console.debug("iot client send data:".concat(JSON.stringify({funCode:e,cmd:t,content:n}),",buffer :[").concat(s.toString("hex"),"]")),this._iotClient.sendData(s)}else console.error("iotCtl.sendMsg invalid arguments ".concat(JSON.stringify({funCode:e,cmd:t,content:n})))}},{key:"_parseBody",value:function(e,t){var n=e.funCode,o=e.cmd;if(n)if(130===o){var r=this._iotProto.getBodyStruct(n).getObj(t);switch(console.debug("\n        recv msg from iot client [".concat(this.host,"],headObj:").concat(JSON.stringify(e),",bodyObj:").concat(JSON.stringify(r))),n){case 209:console.debug("recv msg type [CLIENT_IP] from iot client [".concat(this.host,"]"));break;case 214:console.debug("recv msg type [SERVER_IP] from iot client [".concat(this.host,"]"));break;case 215:console.debug("recv msg type [SERVER_PORT] from iot client [".concat(this.host,"]"));break;case 1:this._handleFanSpeedAck(e,r),console.debug("recv msg type [FAN_SPEED] from iot client [".concat(this.host,"]"));break;case 2:console.debug("recv msg type [TEMPERATURE] from iot client [".concat(this.host,"]"));break;case 3:this._handleBatteryVoltageAck(e,r),console.debug("recv msg type [BATTERY_VOLTAGE] from iot client [".concat(this.host,"]"));break;default:console.warn("IotCtl._parseBody not support this funCode[".concat(n,"],headObj:[").concat(JSON.stringify(e),"]"))}}else 129===o||241===o||console.warn("recv other cmd msg headObj:".concat(JSON.stringify(e)));else console.error("IotCtl._parseBody get invalid headObj :[".concat(e,"]"))}},{key:"_handleBatteryVoltageAck",value:function(e,t){var n=t.batteryVoltage;n?((n<=10||n<=20)&&this._iotInfo.batteryVoltage,this._updateIotInfo({batteryVoltage:n})):console.log("_handleBatteryVoltageAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"_handleFanSpeedAck",value:function(e,t){var n=t.fanSpeed;n?this._updateIotInfo({fanSpeed:n}):console.log("_handleFanSpeedAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"_handleTemperatureAck",value:function(e,t){var n=t.temperature;(n=(+n-50)/10)&&!Number.isNaN(n)?this._updateIotInfo({temperature:n}):console.log("_handleTemperatureAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"queryTemperature",value:function(){this.sendMsg(2,2)}},{key:"queryFanSpeed",value:function(){this.sendMsg(1,2)}},{key:"queryBatteryVoltage",value:function(){this.sendMsg(3,2)}},{key:"setFanSpeed",value:function(e){void 0!==e&&"number"==typeof e?e>100||e<0?console.warn("iotCtl.setFanSpeed fanSpeed is not in valid range, fanSpeed:".concat(e)):this.sendMsg(1,1,{fanSpeed:e}):console.error("iotCtl.setFanSpeed get invalid arguments fanSpeed:".concat(e))}},{key:"initClient",value:function(e){var t=this;this._iotClient?console.log("iot client [".concat(this.host,"] reconnected")):console.log("iot client [".concat(this.host,"] connected")),this.updateStatus(1),this._iotClient=e,this._iotClient.registerHandler("data",this.handleMsg.bind(this)),this._iotClient.registerHandler("error",(function(e){e&&(console.error("iot controller [".concat(t.host,"] got error:").concat(e)),t._iotClient.destroy())})),this._iotClient.registerHandler("close",(function(){t.updateStatus(0),console.warn("iot controller [".concat(t.host,"] disconnected"))}))}}])&&Ie(t.prototype,n),e}(),Ue=function(e,t){var n;return Oe.has(e)?(n=Oe.get(e),console.warn("iot controller for [".concat(e,"] existed, update its client"))):(console.log("init new iot controller [".concat(e,"]")),n=new we(e),Oe.set(e,n)),n.initClient(t),n};function Ae(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}const Re=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t,this.remoteAddress=this._client.address(),this.authenticated=!1,this._initClient(),"192.168.2.52"===this.remoteAddress&&(Ue(this.remoteAddress,this),this.authenticated=!0)}var t,n;return t=e,(n=[{key:"_initClient",value:function(){var e=this;this._client.setTimeout(1e4),this._client.on("close",(function(t){t?(console.error(t),console.log("client [".concat(e.remoteAddress,"] close and err occur"))):console.log("client [".concat(e.remoteAddress,"] close"))})),this._client.on("data",(function(t){if(!e.authenticated)if(Buffer.isBuffer(t)){var n=Buffer.allocUnsafe(4);if(t.copy(n,0,0,4),0===n.compare(Buffer.from(b))){console.log("new lte client authenticated successful");var o=(r=e.remoteAddress,a=e,be.has(r)?(s=be.get(r),console.warn("lte controller for [".concat(r,"] existed, update its client"))):(console.log("init new lte controller [".concat(r,"]")),s=new Ee(r),be.set(r,s)),s.initClient(a),s);o&&o.handMsg(t),e.authenticated=!0}else 0===n.compare(Buffer.from(Z))?(console.log("new iot client authenticated successful"),Ue(e.remoteAddress,e).handleMsg(t),e.authenticated=!0):console.warn("client [".concat(e.remoteAddress,"] recv msg headframe invalid"))}else console.warn("recv data not buffer ,data:".concat(t));var r,a,s})),this._client.on("end",(function(){console.warn("client [".concat(e.remoteAddress,"] end!"))})),this._client.on("error",(function(t){console.warn("client [".concat(e.remoteAddress,"] got error:[").concat(t,"]"))})),this._client.on("timeout",(function(){console.warn("client [".concat(e.remoteAddress,"] timeout"))})),console.log("client [".concat(this.remoteAddress,"] init success"))}},{key:"sendData",value:function(e,t){e&&("string"==typeof e||Buffer.isBuffer(e))?this._client.write(e,t):console.warn("client [".concat(this.remoteAddress,"] send invalid data:[").concat(e,"]"))}},{key:"registerHandler",value:function(e,t){this._client.on(e,t),console.log("register event[".concat(e,"] on client[").concat(this.remoteAddress,"] successful"))}},{key:"destroy",value:function(){this._client.destroy()}}])&&Ae(t.prototype,n),e}();function Pe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._port=t,this._server=(0,o.createServer)((function(e){new Re(e)})),this._server.on("error",(function(e){e&&console.error("lte server got error :".concat(e))})),this._server.on("close",(function(){console.error("lte server closed")}))}var t,n;return t=e,(n=[{key:"startServer",value:function(){this._server.listen(this._port),console.log("server listen on port [".concat(this._port,"]"))}}])&&Pe(t.prototype,n),e}())(3345).startServer()},294:e=>{e.exports=require("babel-polyfill")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(294),n(540)})();