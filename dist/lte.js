(()=>{var e={876:(e,t,n)=>{"use strict";n.d(t,{oh:()=>r,fH:()=>a,xX:()=>o,cP:()=>i});const r={LTE:0},a=new Map;a.set(r.LTE,{prefix:"LTE"});const o="win32"===process.platform?"c:/":"/proc",i={DISCONNECTED:0,IDLE:1,EXCEPTION:2,WORKING:100}},385:(e,t,n)=>{"use strict";n.d(t,{P:()=>r,l:()=>a});const r={SUCCESS:0,ERR_UNKNOWN:-1,ERR_LTE_DISCONNECTED:-2,ERR_LTE_STATUS_EXCEPTION:-3,ERR_LTE_QUERY_TIMEOUT:-4,ERR_INVALID_CONFIG_KEY:-5,ERR_WS_DISCONNECTED:-100},a=new Map;a.set(r.SUCCESS,{msg:"ok"}),a.set(r.ERR_UNKNOWN,{msg:"设备未知错误"}),a.set(r.ERR_LTE_DISCONNECTED,{msg:"设备断开连接"}),a.set(r.ERR_LTE_STATUS_EXCEPTION,{msg:"当前状态不允许发送此消息"}),a.set(r.ERR_LTE_QUERY_TIMEOUT,{msg:"设备回复超时"}),a.set(r.ERR_INVALID_CONFIG_KEY,{msg:"无效的配置信息"}),a.set(r.ERR_WS_DISCONNECTED,{msg:"socketio连接断开"})},345:(e,t,n)=>{"use strict";const r=require("net"),a=require("struct");function o(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c,l,u,f="word8",d="word8",h="word8",_="word16Ule",g="word32Ube",y="word32Ule",v="array",p="chars",m="floatle",S="struct",b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._defineArr=t,this._struct=this.getStruct(),this.length=this._struct.allocate().buffer().length}var t,n;return t=e,(n=[{key:"getStruct",value:function(){var t,n,r=(0,a.Struct)(),s=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=o(e))){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}(this._defineArr);try{for(s.s();!(t=s.n()).done;){var c,l=t.value,u=l[0],f=l[1],d=l[2]||[];if(u&&f)if(u===S)if(1===d.length){var h=d[0];h instanceof e?r=r[u](f,h.getStruct()):console.log("inner struct define invalid,please input custom MsgStruct,err define :".concat(this._defineArr))}else console.error("msg struct define invalid, invalid struct :".concat(JSON.stringify(this._defineArr)));else r=(c=r)[u].apply(c,[f].concat(function(e){if(Array.isArray(e))return i(e)}(n=d)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(n)||o(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()));else console.error("msg struct define error，fieldName:[".concat(f,"],type:[").concat(u,"],optionArr:[").concat(d,"]"))}}catch(e){s.e(e)}finally{s.f()}return r}},{key:"getObj",value:function(e){return this._struct._setBuff(e),this._struct.fields}},{key:"getBuff",value:function(e){return this._struct.set(e),this._struct.buffer()}}])&&s(t.prototype,n),e}();function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){N(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}c=b,l="CustomStruct",u=a.Struct,l in c?Object.defineProperty(c,l,{value:u,enumerable:!0,configurable:!0,writable:!0}):c[l]=u;var M=1431677610,I=[170,170,85,85],O=17,w=61441,A=61442,U=61443,R=61446,T=61451,P=61452,D=61453,x=-1,F=new Map;F.set(x,{text:"连接断开",value:x}),F.set(0,{text:"空闲状态",value:0}),F.set(1,{text:"同步或扫频中",value:1}),F.set(2,{text:"小区激活中",value:2}),F.set(3,{text:"小区已激活",value:3}),F.set(4,{text:"小区去激活中",value:4});var k=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),N(this,"SYS_INIT_SUCC_IND",new b([[_,"CellState"],[_,"Band"],[y,"ulEarfcn"],[y,"dlEarfcn"],[p,"PLMN",[7]],[f,"Bandwidth"],[_,"PCI"],[_,"TAC"]])),N(this,"SYS_ARFCN_CFG",new b([[y,"ulEarfcn"],[y,"dlEarfcn"],[p,"PLMN",[7]],[h,"Bandwidth"],[y,"Band"],[_,"PCI"],[_,"TAC"],[y,"CellId"],[_,"UePMax"],[_,"EnodeBPMax"]])),N(this,"UE_INFO_RPT",new b([[y,"UeIdType "],[p,"IMSI",[O]],[p,"IMEI",[17]],[h,"RSSI"],[h,"STMSIPresent"],[v,"S_TMSI",[5,h]],[v,"Res",[3,h]]])),N(this,"SET_ADMIN_STATE_CFG",new b([[y,"workAdminState"]])),N(this,"ENB_STATE_IND",new b([[y,"CellStateInd"]])),N(this,"PWR1_DEREASE_CFG",new b([[y,"Pwr1Derease"],[h,"IsSave"],[v,"Res",[3,h]]])),N(this,"POWER_DEREASE_QUERY_ACK",new b([[h,"RxGainValueFromReg"],[h,"RxGainValueFromMib"],[h,"PowerDereaseValueFromReg"],[h,"PowerDereaseValueFromMib"],[h,"AgcFlag"],[h,"SnfRxGainValueFromReg"],[h,"SnfRxGainValueFromMib"],[h,"Res"]])),N(this,"MEAS_UE_CFG",new b([[h,"WorkMode"],[h,"RedirectSubMode"],[_,"CapturePeriod"],[p,"IMSI",[O]],[h,"MeasReportPeriod"],[h,"SchdUeMaxPowerTxFlag"],[h,"SchdUeMaxPowerValue"],[h,"SchdUeUlFixedPrbSwitch"],[h,"CampOnAllowedFlag"],[h,"SrsSwitch"],[h,"Res"],[h,"ControlSubMode"],[v,"Res1",[3,h]]])),N(this,"MEAS_INFO_RPT",new b([[h,"UeMeasValue"],[p,"IMSI",[O]],[h,"Res"],[h,"ProtocolVer"]])),N(this,"SYS_MODE_CFG",new b([[y,"sysMode"]])),N(this,"CELL_STATE_INFO",new b([[y,"CellState"]])),N(this,"ARFCN_MOD",new b([[y,"ulEarfcn"],[y,"dlEarfcn"],[p,"PLMN",[7]],[h,"Band"],[y,"CellId"],[_,"UePMax"]])),N(this,"BASE_INFO_QUERY",new b([[y,"EnbBaseInfoType"]])),N(this,"BASE_INFO_QUERY_ACK",new b([[y,"EnbBaseInfoType"],[p,"EnbBaseInfo",[100]]])),N(this,"REBOOT_CFG",new b([[y,"SelfActiveCfg"]])),N(this,"MULTI_BAND_POWERDEREASE_QUERY_ACK",new b([[f,"NumElem"],[p,"Reserved",[3]],[v,"bandPwrdereaseMap",[32,S,b.CustomStruct().word8("band").word8("Pwrderease").chars("Reserved",2)]]])),N(this,"SYS_RXGAIN_CFG",new b([[y,"RxGain"],[f,"RxGainSaveFlag"],[f,"RxOrSnfFlag"],[p,"Res",[3]]])),N(this,"SELFCFG_CELLPARA_REQ",new b([[f,"SelfBand"],[p,"Res",[3]]])),N(this,"_remInfoPrtMain",new b([[_,"collectionCellNum"],[_,"collectionTypeFlag"]])),N(this,"_wrFLCellInfo",new b([[y,"dlEarfcn"],[_,"PCI"],[_,"TAC"],[_,"PLMN"],[_,"TddSfAssignment"],[y,"CellId"],[y,"Priority"],[f,"RSRP"],[f,"RSRQ"],[f,"Bandwidth"],[f,"TddSpecialSfPatterns"]])),N(this,"_wrIntraFreqNeighCellInfo",new b([[y,"dlEarfcn"],[_,"PCI"],[_,"QoffsetCell"]])),N(this,"_stFlLteIntreFreqLst",new b([[y,"dlEarfcn"],[f,"cellReselectPriotry"],[f,"Q_offsetFreq"],[_,"measBandWidth"],[y,"interFreqNghNum"]])),N(this,"_wrFLInterNeighCellInfo",new b([[_,"PCI"],[_,"QoffsetCell"]])),N(this,"REM_INFO_RPT",{length:0,getObj:function(e){try{var n,r=e.length,a=t._remInfoPrtMain.length,o=e.slice(0,a),i=t._remInfoPrtMain.getObj(o);n=a;for(var s=[];r>n;){var c={stCellInfo:[],IntraFreqNeighCellNum:0,stIntraFreqNeighCellInfo:[],InterFreqNum:0,stInterFreqLstInfo:[]},l=t._wrFLCellInfo.length;o=e.slice(n,n+l),c.stCellInfo=t._wrFLCellInfo.getObj(o),c.stCellInfo.Priority>7&&(c.stCellInfo.Priority=0),n+=l,o=e.slice(n,n+4);var u=new Int32Array(o)[0];c.IntraFreqNeighCellNum=u,n+=4;for(var f=[],d=0;d<u;d+=1){var h=t._wrIntraFreqNeighCellInfo.length;o=e.slice(n,n+h),f.push(t._wrIntraFreqNeighCellInfo.getObj(o)),n+=l}c.stIntraFreqNeighCellInfo=f,o=e.slice(n,n+4);var _=new Int32Array(o)[0];c.InterFreqNum=_,n+=4;for(var g=[],y=0;y<_;y+=1){var v=t._stFlLteIntreFreqLst.length;o=e.slice(n,n+v);var p=t._stFlLteIntreFreqLst.getObj(o);n+=v,p.stInterFreqNeighCell=[];for(var m=0;m<p.interFreqNghNum;m+=1){var S=t._wrFLInterNeighCellInfo.length;o=e.slice(n,n+S),p.stInterFreqNeighCell.push(t._wrFLInterNeighCellInfo.getObj(o)),n+=S}g.push(p)}if(c.stInterFreqLstInfo=g,s.push(JSON.parse(JSON.stringify(c))),console.debug("########################################"),console.debug(JSON.stringify(c)),console.debug("########################################"),s.length===i.collectionCellNum)break}return i.stCollCellInfo=s,i}catch(e){return console.error("parsing rem info prt failed, err = ",e),null}}}),N(this,"REM_CFG",new b([[y,"wholeBandRem"],[y,"sysEarfcnNum"],[v,"sysEarfcn",[10,y]]])),N(this,"CONTROL_LIST_QUERY",new b([[f,"ControlListType"],[v,"Res",[3,h]]])),N(this,"CONTROL_LIST_QUERY_ACK",{getObj:function(e){var t=e.slice(0,2),n=new b([[f,"ControlListProperty"],[f,"ControlListUENum"]]).getObj(t),r=C(C({},n),{},{ControlListUEId:[]});if(n.ControlListUENum>0){var a=e.slice(2,e.length);r.ControlListUEId=Object.values(new b([[v,"ControlListUEId",[n.ControlListUENum,p,O]]]).getObj(a).ControlListUEId)}return r}}),N(this,"CONTROL_UE_LIST_CFG",{getBuff:function(e){return new b([[f,"ControlMovement"],[f,"ControlUENum"],[f,"ControlUEProperty"],[v,"ControlUEIdentity",[e.ControlUENum,p,O]],[f,"ClearType"],[f,"RejCause"],[f,"Res"]]).getBuff(e)}}),N(this,"CONTROL_UE_LIST_CFG_ACK",{getObj:function(e){var t=e.slice(0,2),n=new b([[f,"CfgResult"],[f,"IgnoreUENum"]]).getObj(t),r=C(C({},n),{},{IgnoreUEList:[]});if(n.IgnoreUENum>0){var a=e.slice(2,e.length);r.IgnoreUEList=Object.values(new b([[v,"IgnoreUEList",[n.IgnoreUENum,p,O]]]).getObj(a).IgnoreUEList)}return r}}),N(this,"GPS_LOCATION_QUERY_ACK",new b([[y,"Paraoff1"],[m,"Longitude"],[m,"Latitude"],[m,"Altitude"],[y,"RateOfPro"],[y,"Paraoff2"]])),N(this,"COMMON_SET_ACK",new b([[y,"CfgResult"]])),N(this,"COMMON_QUERY",new b([])),this.HEAD=new b([[y,"FrameHeader"],[_,"MsgType"],[_,"MsgLength"],[_,"Frame"],[_,"SubSysCode"]]),this.HEAD_LENGTH=this.HEAD.length,this._MsgStructMap=new Map,this._initMsgStructMap()}var t,n;return t=e,(n=[{key:"getBodyStruct",value:function(e){return this._MsgStructMap.has(e)||console.warn("LteProto.getBodyStruct error invalid ".concat(e,", please make sure you define this struct before")),this._MsgStructMap.get(e)}},{key:"_initMsgStructMap",value:function(){this._MsgStructMap.set(61456,this.SYS_INIT_SUCC_IND),this._MsgStructMap.set(61457,this.COMMON_QUERY),this._MsgStructMap.set(U,this.SYS_ARFCN_CFG),this._MsgStructMap.set(61445,this.UE_INFO_RPT),this._MsgStructMap.set(61444,this.COMMON_SET_ACK),this._MsgStructMap.set(D,this.SET_ADMIN_STATE_CFG),this._MsgStructMap.set(61454,this.COMMON_SET_ACK),this._MsgStructMap.set(61465,this.ENB_STATE_IND),this._MsgStructMap.set(61461,this.PWR1_DEREASE_CFG),this._MsgStructMap.set(61462,this.COMMON_SET_ACK),this._MsgStructMap.set(61489,this.COMMON_QUERY),this._MsgStructMap.set(61490,this.POWER_DEREASE_QUERY_ACK),this._MsgStructMap.set(61479,this.COMMON_QUERY),this._MsgStructMap.set(R,this.MEAS_UE_CFG),this._MsgStructMap.set(61447,this.COMMON_SET_ACK),this._MsgStructMap.set(61480,this.SYS_ARFCN_CFG),this._MsgStructMap.set(61501,this.COMMON_QUERY),this._MsgStructMap.set(61502,this.MEAS_UE_CFG),this._MsgStructMap.set(61448,this.MEAS_INFO_RPT),this._MsgStructMap.set(w,this.SYS_MODE_CFG),this._MsgStructMap.set(A,this.COMMON_SET_ACK),this._MsgStructMap.set(61487,this.COMMON_QUERY),this._MsgStructMap.set(61488,this.CELL_STATE_INFO),this._MsgStructMap.set(61568,this.ARFCN_MOD),this._MsgStructMap.set(61569,this.COMMON_SET_ACK),this._MsgStructMap.set(61483,this.BASE_INFO_QUERY),this._MsgStructMap.set(61484,this.BASE_INFO_QUERY_ACK),this._MsgStructMap.set(T,this.REBOOT_CFG),this._MsgStructMap.set(P,this.COMMON_SET_ACK),this._MsgStructMap.set(61610,this.MULTI_BAND_POWERDEREASE_QUERY_ACK),this._MsgStructMap.set(61609,this.COMMON_QUERY),this._MsgStructMap.set(61459,this.SYS_RXGAIN_CFG),this._MsgStructMap.set(61460,this.COMMON_SET_ACK),this._MsgStructMap.set(61519,this.SELFCFG_CELLPARA_REQ),this._MsgStructMap.set(61520,this.COMMON_SET_ACK),this._MsgStructMap.set(61450,this.REM_INFO_RPT),this._MsgStructMap.set(61449,this.REM_CFG),this._MsgStructMap.set(61507,this.CONTROL_LIST_QUERY),this._MsgStructMap.set(61508,this.CONTROL_LIST_QUERY_ACK),this._MsgStructMap.set(61497,this.CONTROL_UE_LIST_CFG),this._MsgStructMap.set(61498,this.CONTROL_UE_LIST_CFG_ACK),this._MsgStructMap.set(61532,this.COMMON_QUERY),this._MsgStructMap.set(61533,this.GPS_LOCATION_QUERY_ACK)}}])&&E(t.prototype,n),e}(),B=new Map;B.set(0,{value:0,text:"空口同步成功",CellState:2}),B.set(1,{value:1,text:"空口同步失败",CellState:2}),B.set(2,{value:2,text:"GPS同步成功",CellState:4}),B.set(3,{value:3,text:"GPS同步失败",CellState:2}),B.set(4,{value:4,text:"扫频成功",CellState:0}),B.set(5,{value:5,text:"扫频失败",CellState:0}),B.set(6,{value:6,text:"小区建立成功",CellState:3}),B.set(7,{value:7,text:"小区建立失败",CellState:0}),B.set(8,{value:8,text:"小区去激活",CellState:0}),B.set(9,{value:9,text:"空口同步中",CellState:1}),B.set(10,{value:10,text:"GPS同步中",CellState:1}),B.set(11,{value:11,text:"扫频中",CellState:1}),B.set(12,{value:12,text:"小区建立中",CellState:2}),B.set(13,{value:13,text:"小区去激活中",CellState:4}),B.set(65535,{value:65535,text:"无效状态",CellState:0});var j=100,G=new Map;G.set(25,{value:25,text:"5M"}),G.set(50,{value:50,text:"10M"}),G.set(75,{value:75,text:"15M"}),G.set(j,{value:j,text:"20M"});var V=255,Q=65280,J=new Map;J.set(Q,{value:Q,text:"FDD"}),J.set(V,{value:V,text:"TDD"});var H=new Map;H.set(0,{value:0,text:"持续侦码模式"}),H.set(1,{value:1,text:"周期侦码模式"}),H.set(2,{value:2,text:"定位模式"}),H.set(3,{value:3,text:"管控模式"}),H.set(4,{value:4,text:"重定向模式"});var Y=new Map;Y.set(0,{value:0,text:"120ms"}),Y.set(1,{value:1,text:"240ms"}),Y.set(2,{value:2,text:"480ms"}),Y.set(3,{value:3,text:"640ms"}),Y.set(4,{value:4,text:"1024ms"}),Y.set(5,{value:5,text:"2048ms"});var q=new Map;q.set(0,{value:0,text:"R8"}),q.set(1,{value:1,text:"R10"});var K=function(e,t){return t===Q?18e3+e:255},W={DEVICE_MODEL:0,HARDWARE_VERSION:1,SOFTWARE_VERSION:2,BOARDSN:3,MAC:4,UBOOT_VERSION:5,BOARD_TEMPERATURE:6},X={CMCC:{frequencyRange:[[939,949],[1805,1830],[1880,1920],[2010,2025],[2320,2370],[2515,2675]],PLMNList:[46e3],text:"中国移动",shortHand:"移动",key:0},CUCC:{frequencyRange:[[949,960],[1830,1860],[2130,2170],[2300,2320]],PLMNList:[46001],text:"中国联通",shortHand:"联通",key:1},CTCC:{frequencyRange:[[869,894],[925,938],[1860,1880],[2110,2130],[2370,2390]],PLMNList:[46011],text:"中国电信",shortHand:"电信",key:2},OTHER:{frequencyRange:[],PLMNList:[],text:"未知",shortHand:"未知",key:-1},ALL:{frequencyRange:[],PLMNList:[],text:"全部运营商",shortHand:"全部",key:99}},z=(J.get(V),G.get(j),F.get(x),[U,D,w,R]);function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=2864434397,te=[170,187,204,221],ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"_CLIENT_IP_STRUCT",new b([[v,"clientIP",[4,d]]])),Z(this,"_CLIENT_MAC_STRUCT",new b([[v,"clientMAC",[6,d]]])),Z(this,"_FAN_SPEED_STRUCT",new b([[d,"fanSpeed"]])),Z(this,"_TEMPERATURE_STRUCT",new b([["word16Ube","temperature"]])),Z(this,"_BATTERY_VOLTAGE_STRUCT",new b([[f,"batteryVoltage"]])),Z(this,"_SERVER_IP_STRUCT",new b([[v,"serverIP",[4,d]]])),Z(this,"_SERVER_PORT_STRUCT",new b([[g,"serverPort"]])),this.HEAD_STRUCT=new b([[g,"fixHead"],[d,"funCode"],[d,"cmd"],[d,"contentLength"]]),this.HEAD_LEN=this.HEAD_STRUCT.length,this.END_STRUCT=new b([[d,"fixEnd"]]),this.END_LEN=this.END_STRUCT.length,this.IOT_COMMON_QUERY=new b([]),this._bodyStructMap=new Map,this.initBodyStructMap()}var t,n;return t=e,(n=[{key:"initBodyStructMap",value:function(){this._bodyStructMap.set(209,this._CLIENT_IP_STRUCT),this._bodyStructMap.set(213,this._CLIENT_MAC_STRUCT),this._bodyStructMap.set(214,this._SERVER_IP_STRUCT),this._bodyStructMap.set(215,this._SERVER_PORT_STRUCT),this._bodyStructMap.set(1,this._FAN_SPEED_STRUCT),this._bodyStructMap.set(2,this._TEMPERATURE_STRUCT),this._bodyStructMap.set(3,this._BATTERY_VOLTAGE_STRUCT)}},{key:"getBodyStruct",value:function(e){return this._bodyStructMap.has(e)||console.error("IotProto.getBodyStruct not support this function code :[".concat(e,"]")),this._bodyStructMap.get(e)}}])&&$(t.prototype,n),e}(),re=new Map;re.set(0,{value:0,text:"连接断开"}),re.set(1,{value:1,text:"已连接"});const ae=require("moment");var oe=n.n(ae),ie=new Map;ie.set(0,"用户名不存在"),ie.set(1,"密码不正确"),ie.set(2,"软件版本已过期");var se={"192.168.2.53":[39,3,34],"192.168.2.54":[38,40,41,1,5,8]};const ce=JSON.parse('{"1":{"band":1,"FDL_low":2110,"NOffs_DL":0,"NDL_min":0,"NDL_max":599,"FUL_low":1920,"NOffs_UL":18000,"NUL_min":18000,"NUL_max":18599},"2":{"band":2,"FDL_low":1930,"NOffs_DL":600,"NDL_min":600,"NDL_max":1199,"FUL_low":1850,"NOffs_UL":18600,"NUL_min":18600,"NUL_max":19199},"3":{"band":3,"FDL_low":1805,"NOffs_DL":1200,"NDL_min":1200,"NDL_max":1949,"FUL_low":1710,"NOffs_UL":19200,"NUL_min":19200,"NUL_max":19949},"4":{"band":4,"FDL_low":2110,"NOffs_DL":1950,"NDL_min":1950,"NDL_max":2399,"FUL_low":1710,"NOffs_UL":19950,"NUL_min":19950,"NUL_max":20399},"5":{"band":5,"FDL_low":869,"NOffs_DL":2400,"NDL_min":2400,"NDL_max":2649,"FUL_low":824,"NOffs_UL":20400,"NUL_min":20400,"NUL_max":20649},"6":{"band":6,"FDL_low":875,"NOffs_DL":2650,"NDL_min":2650,"NDL_max":2749,"FUL_low":830,"NOffs_UL":20650,"NUL_min":20650,"NUL_max":20749},"7":{"band":7,"FDL_low":2620,"NOffs_DL":2750,"NDL_min":2750,"NDL_max":3449,"FUL_low":2500,"NOffs_UL":20750,"NUL_min":20750,"NUL_max":21449},"8":{"band":8,"FDL_low":925,"NOffs_DL":3450,"NDL_min":3450,"NDL_max":3799,"FUL_low":880,"NOffs_UL":21450,"NUL_min":21450,"NUL_max":21799},"9":{"band":9,"FDL_low":1844.9,"NOffs_DL":3800,"NDL_min":3800,"NDL_max":4149,"FUL_low":1749.9,"NOffs_UL":21800,"NUL_min":21800,"NUL_max":22149},"10":{"band":10,"FDL_low":2110,"NOffs_DL":4150,"NDL_min":4150,"NDL_max":4749,"FUL_low":1710,"NOffs_UL":22150,"NUL_min":22150,"NUL_max":22749},"11":{"band":11,"FDL_low":1475.9,"NOffs_DL":4750,"NDL_min":4750,"NDL_max":4949,"FUL_low":1427.9,"NOffs_UL":22750,"NUL_min":22750,"NUL_max":22949},"12":{"band":12,"FDL_low":729,"NOffs_DL":5010,"NDL_min":5010,"NDL_max":5179,"FUL_low":699,"NOffs_UL":23010,"NUL_min":23010,"NUL_max":23179},"13":{"band":13,"FDL_low":746,"NOffs_DL":5180,"NDL_min":5180,"NDL_max":5279,"FUL_low":777,"NOffs_UL":23180,"NUL_min":23180,"NUL_max":23279},"14":{"band":14,"FDL_low":758,"NOffs_DL":5280,"NDL_min":5280,"NDL_max":5379,"FUL_low":788,"NOffs_UL":23280,"NUL_min":23280,"NUL_max":23379},"17":{"band":17,"FDL_low":734,"NOffs_DL":5730,"NDL_min":5730,"NDL_max":5849,"FUL_low":704,"NOffs_UL":23730,"NUL_min":23730,"NUL_max":23849},"18":{"band":18,"FDL_low":860,"NOffs_DL":5850,"NDL_min":5850,"NDL_max":5999,"FUL_low":815,"NOffs_UL":23850,"NUL_min":23850,"NUL_max":23999},"19":{"band":19,"FDL_low":875,"NOffs_DL":6000,"NDL_min":6000,"NDL_max":6149,"FUL_low":830,"NOffs_UL":24000,"NUL_min":24000,"NUL_max":24149},"20":{"band":20,"FDL_low":791,"NOffs_DL":6150,"NDL_min":6150,"NDL_max":6449,"FUL_low":832,"NOffs_UL":24150,"NUL_min":24150,"NUL_max":24449},"21":{"band":21,"FDL_low":1495.9,"NOffs_DL":6450,"NDL_min":6450,"NDL_max":6599,"FUL_low":1447.9,"NOffs_UL":24450,"NUL_min":24450,"NUL_max":24599},"22":{"band":22,"FDL_low":3510,"NOffs_DL":6600,"NDL_min":6600,"NDL_max":7399,"FUL_low":3410,"NOffs_UL":24600,"NUL_min":24600,"NUL_max":25399},"23":{"band":23,"FDL_low":2180,"NOffs_DL":7500,"NDL_min":7500,"NDL_max":7699,"FUL_low":2000,"NOffs_UL":25500,"NUL_min":25500,"NUL_max":25699},"24":{"band":24,"FDL_low":1525,"NOffs_DL":7700,"NDL_min":7700,"NDL_max":8039,"FUL_low":1626.5,"NOffs_UL":25700,"NUL_min":25700,"NUL_max":26039},"25":{"band":25,"FDL_low":1930,"NOffs_DL":8040,"NDL_min":8040,"NDL_max":8689,"FUL_low":1850,"NOffs_UL":26040,"NUL_min":26040,"NUL_max":26689},"26":{"band":26,"FDL_low":859,"NOffs_DL":8690,"NDL_min":8690,"NDL_max":9039,"FUL_low":814,"NOffs_UL":26690,"NUL_min":26690,"NUL_max":27039},"27":{"band":27,"FDL_low":852,"NOffs_DL":9040,"NDL_min":9040,"NDL_max":9209,"FUL_low":807,"NOffs_UL":27040,"NUL_min":27040,"NUL_max":27209},"28":{"band":28,"FDL_low":758,"NOffs_DL":9210,"NDL_min":9210,"NDL_max":9659,"FUL_low":703,"NOffs_UL":27210,"NUL_min":27210,"NUL_max":27659},"31":{"band":31,"FDL_low":462.5,"NOffs_DL":9870,"NDL_min":9870,"NDL_max":9919,"FUL_low":452.5,"NOffs_UL":27760,"NUL_min":27760,"NUL_max":27809},"33":{"band":33,"FDL_low":1900,"NOffs_DL":36000,"NDL_min":36000,"NDL_max":36199,"FUL_low":1900,"NOffs_UL":36000,"NUL_min":36000,"NUL_max":36199},"34":{"band":34,"FDL_low":2010,"NOffs_DL":36200,"NDL_min":36200,"NDL_max":36349,"FUL_low":2010,"NOffs_UL":36200,"NUL_min":36200,"NUL_max":36349},"35":{"band":35,"FDL_low":1850,"NOffs_DL":36350,"NDL_min":36350,"NDL_max":36949,"FUL_low":1850,"NOffs_UL":36350,"NUL_min":36350,"NUL_max":36949},"36":{"band":36,"FDL_low":1930,"NOffs_DL":36950,"NDL_min":36950,"NDL_max":37549,"FUL_low":1930,"NOffs_UL":36950,"NUL_min":36950,"NUL_max":37549},"37":{"band":37,"FDL_low":1910,"NOffs_DL":37550,"NDL_min":37550,"NDL_max":37749,"FUL_low":1910,"NOffs_UL":37550,"NUL_min":37550,"NUL_max":37749},"38":{"band":38,"FDL_low":2570,"NOffs_DL":37750,"NDL_min":37750,"NDL_max":38249,"FUL_low":2570,"NOffs_UL":37750,"NUL_min":37750,"NUL_max":38249},"39":{"band":39,"FDL_low":1880,"NOffs_DL":38250,"NDL_min":38250,"NDL_max":38649,"FUL_low":1880,"NOffs_UL":38250,"NUL_min":38250,"NUL_max":38649},"40":{"band":40,"FDL_low":2300,"NOffs_DL":38650,"NDL_min":38650,"NDL_max":39649,"FUL_low":2300,"NOffs_UL":38650,"NUL_min":38650,"NUL_max":39649},"41":{"band":41,"FDL_low":2496,"NOffs_DL":39650,"NDL_min":39650,"NDL_max":41589,"FUL_low":2496,"NOffs_UL":39650,"NUL_min":39650,"NUL_max":41589},"42":{"band":42,"FDL_low":3400,"NOffs_DL":41590,"NDL_min":41590,"NDL_max":43589,"FUL_low":3400,"NOffs_UL":41590,"NUL_min":41590,"NUL_max":43589},"43":{"band":43,"FDL_low":3600,"NOffs_DL":43590,"NDL_min":43590,"NDL_max":45589,"FUL_low":3600,"NOffs_UL":43590,"NUL_min":43590,"NUL_max":45589},"44":{"band":44,"FDL_low":703,"NOffs_DL":45590,"NDL_min":45590,"NDL_max":46589,"FUL_low":703,"NOffs_UL":45590,"NUL_min":45590,"NUL_max":46589}}');function le(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ue(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ue(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fe(e){for(var t in ce){var n=ce[t];if(n.NDL_min<=+e&&n.NDL_max>=+e)return n}}function de(e){var t=+e;if(!t.isNaN){var n=function(e){var t=fe(e);if(t)return t.band;console.warn("ArfcnUtils.getBandFromEarfcn failed , invalid earfcn :[".concat(e,"]"))}(t);if(n){var r=function(e){if("number"==typeof e){var t=fe(e);if(!t)return;var n=t.NOffs_DL,r=t.FDL_low;return void 0!==n&&void 0!==r?(e-n)/10+r:void 0}}(t);if(r){var a=function(e){if("number"==typeof e)for(var t in X){var n,r=X[t],a=le(r.frequencyRange);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(e>=o[0]&&e<=o[1])return r}}catch(e){a.e(e)}finally{a.f()}}}(r);if(a){var o=String(a.PLMNList[0]);return{Band:String(n)||"",PLMN:o||""}}}}}}function he(){return Math.floor(268435455*Math.random())}var _e=n(385);const ge=require("events");function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ve=new(n.n(ge)()),pe=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._emitter=t}var t,n;return t=e,(n=[{key:"on",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this._emitter).on.apply(t,[e].concat(r)),console.debug("listen [".concat(e,"] exist listener [").concat(this._emitter.listenerCount(e),"]"))}},{key:"emit",value:function(e){for(var t,n,r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];(t=this._emitter).emit.apply(t,[e].concat(a)),(n=console).debug.apply(n,["emit [".concat(e,"] exist listener [").concat(this._emitter.listenerCount(e),"] ")].concat(a))}}])&&ye(t.prototype,n),e}())(ve),me="cellInfoChanged",Se=n(747),be=n.n(Se),Le=n(622),Ce=n.n(Le);const Ee=JSON.parse('{"wsServerCfg":{"host":"127.0.0.1","port":"80","namespace":"/lte"},"lteCellInfo":{"192.168.2.53":{"Frame":{"value":255,"text":"TDD"},"Band":3,"settingCellInfo":{"ulEarfcn":0,"dlEarfcn":0,"Band":0,"PLMN":0,"CellId":0,"UePMax":0},"ulEarfcn":255,"dlEarfcn":37900,"PLMN":"46000","SOFTWARE_VERSION":"","Bandwidth":{"value":100,"text":"20M"},"PCI":1,"RxGainValueFromReg":0,"RxGainValueFromMib":0,"Pwr1Derease":0,"PowerDereaseValueFromReg":0,"PowerDereaseValueFromMib":0,"AgcFlag":0,"SnfRxGainValueFromReg":0,"SnfRxGainValueFromMib":0,"RxOrSnfFlag":0,"dlEarfcnList":[37900],"blackControlList":[],"whiteControlList":[],"earfcnAutoModing":false,"modInterval":5,"boardTemperature":0,"bandPwrdereaseMap":{},"Longitude":119.9800033569336,"Latitude":39.22999954223633,"Altitude":200,"MeasUECfg":{"WorkMode":0,"RedirectSubMode":4,"CapturePeriod":5,"IMSI":"","MeasReportPeriod":3,"SchdUeMaxPowerTxFlag":0,"SchdUeMaxPowerValue":23,"SchdUeUlFixedPrbSwitch":0,"CampOnAllowedFlag":0,"SrsSwitch":0,"ControlSubMode":0}},"192.168.2.54":{"Frame":{"value":255,"text":"TDD"},"Band":3,"settingCellInfo":{"ulEarfcn":0,"dlEarfcn":0,"Band":0,"PLMN":0,"CellId":0,"UePMax":0},"ulEarfcn":255,"dlEarfcn":37900,"PLMN":"46000","SOFTWARE_VERSION":"","Bandwidth":{"value":100,"text":"20M"},"PCI":1,"RxGainValueFromReg":0,"RxGainValueFromMib":0,"Pwr1Derease":0,"PowerDereaseValueFromReg":0,"PowerDereaseValueFromMib":0,"AgcFlag":0,"SnfRxGainValueFromReg":0,"SnfRxGainValueFromMib":0,"RxOrSnfFlag":0,"dlEarfcnList":[38400],"blackControlList":[],"whiteControlList":[],"earfcnAutoModing":false,"modInterval":5,"boardTemperature":0,"bandPwrdereaseMap":{},"Longitude":119.9800033569336,"Latitude":39.22999954223633,"Altitude":200,"MeasUECfg":{"WorkMode":0,"RedirectSubMode":4,"CapturePeriod":5,"IMSI":"","MeasReportPeriod":3,"SchdUeMaxPowerTxFlag":0,"SchdUeMaxPowerValue":23,"SchdUeUlFixedPrbSwitch":0,"CampOnAllowedFlag":0,"SrsSwitch":0,"ControlSubMode":0}}},"configLocalFilePath":"config/default.local.json"}');var Ne=n(438);let Me=Ee;const Ie=Ee.configLocalFilePath;!function(){try{(0,Ne.k)(Ce().dirname(Ie));const e=JSON.parse(be().readFileSync(Ie,"utf-8"));Me={...Ee,...e}}catch(e){e&&console.error(e)}be().writeFileSync(Ie,JSON.stringify(Me))}();const Oe={...Me,get lteCellInfo(){return Me.lteCellInfo},set lteCellInfo(e){!function(e){for(let t in e)Me[t]=e[t];be().writeFileSync(Ie,JSON.stringify(Me))}({lteCellInfo:e})}};function we(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Ue(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}}(e,t)||Ue(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ue(e,t){if(e){if("string"==typeof e)return Re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Re(e,t):void 0}}function Re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Te(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function Pe(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Te(o,r,a,i,s,"next",e)}function s(e){Te(o,r,a,i,s,"throw",e)}i(void 0)}))}}function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ke(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ge=Oe.lteCellInfo,Ve=new Map,Qe=function(){function e(t){var n,r,a,o=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ke(this,e),je(this,"_initLog",(function(){for(var e=function(){var e=n[t];o[e]=function(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=console)[e].apply(t,["[".concat(o.host,"]")].concat(r))}},t=0,n=["debug","log","warn","error"];t<n.length;t++)e()})),je(this,"getAndClearUEList",(function(){var e=o.ueListCache;return o.ueListCache=[],e})),je(this,"_intervalQuery",(function(){o._cellInfo.status.value!==x&&(o.sendBaseInfoQuery(W.BOARD_TEMPERATURE),o.checkIfNeedAutoModEarfcn())})),je(this,"getCellInfo",(function(){return o._cellInfo})),je(this,"_updateCellInfo",(function(e){if(o.debug(" updating cellInfos:",JSON.stringify(e)),e){var t=!1;for(var n in e)if(o._cellInfo.hasOwnProperty(n))if(Array.isArray(e[n])&&Array.isArray(o._cellInfo[n]))o._cellInfo[n]=e[n],t=!0;else if("Frame"===n||"Bandwidth"===n||"status"===n)e[n].value!==o._cellInfo[n].value&&(o._cellInfo[n]=e[n],t=!0);else if("BandPwrdereaseMap"===n){var r=e[n];for(var a in r)if(r[a]!==o._cellInfo[n][a]){o._cellInfo[n]=r,t=!0;break}}else if("object"===Fe(e[n])){var i=e[n];for(var s in i)i[s]!==o._cellInfo[n][s]&&(o._cellInfo[n][s]=i[s],t=!0)}else e[n]!==o._cellInfo[n]&&(o._cellInfo[n]=e[n],t=!0);else o.error("LteController._updateCellInfo get invalid key[".concat(n,"] in info:[").concat(e,"]"));t&&(o.debug("client  updated info is :[".concat(JSON.stringify(o._cellInfo),"]")),pe.emit(me,{host:o.host,cellInfo:o._cellInfo}),Oe.lteCellInfo=xe(xe({},Ge),{},je({},o.host,o._cellInfo)))}else o.error("LTEController._updateCellInfo :client  recv invalid info: ".concat(e))})),this._lteClient=void 0,this._lteProto=new k,this.host=t,this._initLog(),this.cacheMsg=new Map,this.cacheBuff=Buffer.allocUnsafe(0),this.ueListCache=[],this.saveProcess=void 0,this._TransID=1,this._LTETransID=1,this.autoModEarfcnProcess=setInterval,this.temperatureAlertTimes75=0,this._cellInfo={Frame:J.get(Q),Band:0,settingCellInfo:{ulEarfcn:0,dlEarfcn:0,Band:0,PLMN:0,CellId:0,UePMax:0},ulEarfcn:0,dlEarfcn:0,PLMN:"",SOFTWARE_VERSION:"",Bandwidth:G.get(j),PCI:0,RxGainValueFromReg:0,RxGainValueFromMib:0,Pwr1Derease:0,PowerDereaseValueFromReg:0,PowerDereaseValueFromMib:0,AgcFlag:0,SnfRxGainValueFromReg:0,SnfRxGainValueFromMib:0,RxOrSnfFlag:0,dlEarfcnList:[],blackControlList:[],whiteControlList:[],earfcnAutoModing:!1,modInterval:5,boardTemperature:0,bandPwrdereaseMap:{},Longitude:0,Latitude:0,Altitude:0,MeasUECfg:{WorkMode:0,RedirectSubMode:4,CapturePeriod:5,IMSI:"",MeasReportPeriod:3,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:0,SrsSwitch:0,ControlSubMode:0},status:F.get(x)},this._updateCellInfo(xe(xe({},i),{},{status:F.get(x)})),this.cbMap={},this.initCheckCBMap(),this._airSyncFailedRetryTimes=2,this._nearbyEarfcnMap=(je(a={},V,(je(n={},X.CMCC.key,[]),je(n,X.CTCC.key,[]),je(n,X.CUCC.key,[]),n)),je(a,Q,(je(r={},X.CMCC.key,[]),je(r,X.CTCC.key,[]),je(r,X.CUCC.key,[]),r)),a),this._latestMeasInfo={}}var t,n,r,a,o,i;return t=e,(n=[{key:"checkIfNeedAutoModEarfcn",value:function(){var e=this._cellInfo,t=e.status,n=e.earfcnAutoModing;3===t.value&&n&&this.startAutoModEarfcn()}},{key:"initClient",value:function(e){var t=this;this._lteClient?this.log("lte client  reconnected"):this.log("lte client  connected"),this._lteClient=e,this._lteClient.registerHandler("data",this.handMsg.bind(this)),this._lteClient.registerHandler("error",(function(e){e&&(t.error("lte controller  got error:".concat(e)),t._lteClient.destroy())})),this._lteClient.registerHandler("close",(function(){t.updateStatus(x),t.warn("lte controller  disconnected")})),this._lteClient.registerHandler("timeout",(function(){t.updateStatus(x),t.warn("lte controller  timeout"),t._lteClient.destroy()}))}},{key:"initQuery",value:function(){var e=this,t=[this.sendPowerDereaseQuery,this.sendMeasUECfgQuery,this.sendMultiBandPowerdereaseQuery,function(){e.sendControlListQuery(0)},function(){e.sendControlListQuery(1)},function(){e.sendSysRxGainCfg(42,1,0)},function(){e.sendBaseInfoQuery(W.SOFTWARE_VERSION)}];this._cellInfo.earfcnAutoModing&&t.push(this.startAutoModEarfcn);for(var n=function(n){setTimeout((function(){t[n].call(e)}),500*n)},r=0;r<t.length;r+=1)n(r)}},{key:"updateStatus",value:function(e){var t=this._cellInfo.status;t.value!==e?F.has(e)?(this._cellInfo.status.value===x&&e!==x&&this.initQuery(),this._cellInfo.status=F.get(e),this.log("lte status changed from [".concat(t.text,"] to [").concat(this._cellInfo.status.text,"]"))):this.error("LTEControllers.updateStatus invalid arguments :".concat(e)):this.debug("current state is ".concat(t.text,", not changed"))}},{key:"registerCB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.cfgMsgType,o=r.ackMsgType,i=r.timeout,s=r.doNotNeedCommonHandle,c="".concat(e,"_").concat(t);this.cbMap[c]&&this.warn(" 已存在".concat(c,"对应的回调函数")),this.cbMap[c]={cb:n,time:oe()().unix(),cfgMsgType:a,ackMsgType:o,timeout:i,doNotNeedCommonHandle:s},this.log("注册事件 key:[".concat(c,"] info:").concat(JSON.stringify(this.cbMap[c])))}},{key:"registerCBAsync",value:(i=Pe(regeneratorRuntime.mark((function e(t,n){var r,a=this,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:{},e.abrupt("return",new Promise((function(e){a.registerCB(t,n,(function(t,n){e([t,n])}),r)})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"_activateCB",value:function(e,t,n,r){var a=r.headObj,o=r.bodyObj,i="".concat(e,"_").concat(t);if(this.cbMap[i]){this.log(" 触发回调事件 ".concat(i)),this.cbMap[i].cb(n,{headObj:a,bodyObj:o});var s=this.cbMap[i].doNotNeedCommonHandle;return delete this.cbMap[i],s}return!1}},{key:"initCheckCBMap",value:function(){var e=this;setInterval((function(){for(var t in e.cbMap){var n=e.cbMap[t],r=n.cb,a=n.timeout,o=n.time;oe()().unix()-o>(a||10)&&(e.error("callback ".concat(t," timeout")),r(_e.P.ERR_LTE_QUERY_TIMEOUT),e.error("clear lte callback key:[".concat(t,"] now:[").concat(oe()().unix(),"] start:[").concat(o,"]")),delete e.cbMap[t])}}),1e3)}},{key:"handMsg",value:function(e){var t,n=[];if(Buffer.isBuffer(e)){this.debug("recv msg,buffer:".concat(e.toString("hex"))),this.cacheBuff=Buffer.concat([this.cacheBuff,e]);try{for(var r=0;this.cacheBuff.length>=this._lteProto.HEAD_LENGTH;){r+=1;var a=this.cacheBuff.slice(0,this._lteProto.HEAD_LENGTH),o=this._lteProto.HEAD.getObj(a);this.debug("head parsed",JSON.stringify(o)),o.Frame!==this._cellInfo.Frame.value&&J.has(o.Frame)&&this._updateCellInfo({Frame:J.get(o.Frame)});var i=o.SubSysCode>>>15,s=32767&o.SubSysCode;this._LTETransID=s,o.transID=s,o.ifLeft=i;var c=this.cacheBuff.slice(this._lteProto.HEAD_LENGTH,o.MsgLength);this.debug("slice data ,headBuf:".concat(a.toString("hex"),",body buffer:").concat(c.toString("hex"))),1!==i?(this.cacheMsg.has(s)&&(c=Buffer.concat([].concat(function(e){if(Array.isArray(e))return Re(e)}(t=this.cacheMsg.get(s))||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||Ue(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[c])),this.debug("分包处理完毕, bodyBuf 合体 ".concat(c.toString("hex"))),this.cacheMsg.delete(s)),this.cacheBuff=this.cacheBuff.slice(o.MsgLength),this.cacheBuff.length>0&&this.debug("粘包了 剩余buffer ".concat(this.cacheBuff.toString("hex"))),n.push(o),this._parseBody(o,c)):(this.log("收到分包消息，tranID:".concat(s)),this.cacheMsg.has(s)?this.cacheMsg.get(s).push(c):this.cacheMsg.set(s,[c]),this.cacheBuff=this.cacheBuff.slice(o.MsgLength))}this.debug("parsed msg in ".concat(r," times")),this.cacheBuff.length>0&&(this.debug(" 粘包处理完了 还剩buffer？ ".concat(this.cacheBuff.toString("hex"))),this.cacheBuff=Buffer.allocUnsafe(0))}catch(e){e&&(this.error("parse msg from lte client run error ,err:[".concat(e,"],msg buffer:[").concat(this.cacheBuff.toString("hex"),"] headList:").concat(JSON.stringify(n))),this.cacheMsg=new Map)}}else this.error("recv data is not buffer ,data:".concat(e))}},{key:"_parseBody",value:function(e,t){var n=e.MsgType,r=this._lteProto.getBodyStruct(n);if(r){var a=r.getObj(t);this.debug(" parsed msg ,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(JSON.stringify(a)));var o=this._activateCB(1,e.MsgType,null,{headObj:e,bodyObj:a});if(this._activateCB(0,e.transID,null,{headObj:e,bodyObj:a}),!o)switch(n){case 61456:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_INIT_SUCC_IND],body:".concat(JSON.stringify(a))),this._handleSysInitSuccInd(e,a);break;case 61444:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_ARFCN_ACK],body:".concat(JSON.stringify(a))),this._handSysArfcnAck(e,a);break;case 61445:this.debug("recv msg type:[O_FL_ENB_TO_LMT_UE_INFO_RPT],body:".concat(JSON.stringify(a))),this._handleUeInfoPrt(e,a);break;case 61454:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SET_ADMIN_STATE_ACK],body:".concat(JSON.stringify(a))),this._handSetAdminStateAck(e,a);break;case 61465:this.debug("recv msg type:[O_FL_ENB_TO_LMT_ENB_STATE_IND],body:".concat(JSON.stringify(a))),this._handEnbStateInd(e,a);break;case 61490:this.debug("recv msg type:[O_FL_ENB_TO_LMT_RXGAIN_POWER_DEREASE_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handlePowerDereaseQueryAck(e,a);break;case 61462:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_PWR1_DEREASE_ACK],body:".concat(JSON.stringify(a))),this._handlePwr1DereaseAck(e,a);break;case 61447:this.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_UE_ACK],body:".concat(JSON.stringify(a))),this._handleMeasUEAck(e,a);break;case 61502:this.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_UE_CFG_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handleMeasUECfgQueryAck(e,a);break;case 61448:this.debug("recv msg type:[O_FL_ENB_TO_LMT_MEAS_INFO_RPT],body:".concat(JSON.stringify(a))),this._handleMeasInfoPrt(e,a);break;case A:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_MODE_ACK],body:".concat(JSON.stringify(a))),this._handleSysModeAck(e,a);break;case 61488:this.debug("recv msg type:[O_FL_ENB_TO_LMT_CELL_STATE_INFO_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handleCellStateInfoQueryAck(e,a);break;case 61569:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_ARFCN_MOD_ACK],body:".concat(JSON.stringify(a))),this._handleEarfcnModAck(e,a);break;case 61484:this.debug("recv msg type:[O_FL_ENB_TO_LMT_BASE_INFO_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handleBaseInfoQueryAck(e,a);break;case P:this.debug("recv msg type:[O_FL_ENB_TO_LMT_REBOOT_ACK],body:".concat(JSON.stringify(a))),this._handleRebootAck(e,a);break;case 61610:this.debug("recv msg type:[O_FL_ENB_TO_LMT_MULTI_BAND_POWERDEREASE_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handleMultiBandPowerdereaseQueryAck(e,a);break;case 61460:this.debug("recv msg type:[O_FL_ENB_TO_LMT_SYS_RxGAIN_ACK],body:".concat(JSON.stringify(a))),this._handleSysRxGainCfgAck(e,a);break;case 61520:this.debug("recv msg type:[O_FL_LMT_TO_ENB_SELFCFG_CELLPARA_REQ_ACK],body:".concat(JSON.stringify(a))),this._handleSelfCfgCellParaReqAck(e,a);break;case 61450:this.debug("recv msg type:[O_FL_ENB_TO_LMT_REM_INFO_RPT],body:".concat(JSON.stringify(a))),this._handleRemInfoPrt(e,a);break;case 61498:this.debug("recv msg type:[O_FL_ENB_TO_LMT_CONTROL_UE_LIST_CFG_ACK],body:".concat(JSON.stringify(a))),this._handleControlUEListCfgAck(e,a);break;case 61508:this.debug("recv msg type:[O_FL_ENB_TO_LMT_CONTROL_LIST_QUERY_ACK],body:".concat(JSON.stringify(a))),this._handleControlListQueryAck(e,a);break;case 61533:this.debug("recv msg type:[O_FL_ENB_TO_LMT_GPS_LOCATION_QUERY_ACK],body:".concat(JSON.stringify(a))),this.handleGpsLocationQueryAck(e,a)}}else this.error("cannot support this msg type [".concat(n,"]"))}},{key:"_sendDataAsync",value:function(e){var t=this;return new Promise((function(n){t._lteClient.sendData(e,(function(){n(!0)}))}))}},{key:"packAndSendMsg",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._cellInfo.earfcnAutoModing||!z.includes(e)){var r,a;if(t){var o=this._lteProto.getBodyStruct(e);r=o.getBuff(t)}else r=Buffer.from([]);n?a=this._LTETransID:(this._TransID+=1,a=this._TransID);var i={FrameHeader:M,MsgType:e,MsgLength:this._lteProto.HEAD_LENGTH+r.length,Frame:this._cellInfo.Frame.value,SubSysCode:a};this.debug("lte server send msg to client ,head:".concat(JSON.stringify(i),",body:").concat(JSON.stringify(t)));var s=this._sendData(Buffer.concat([this._lteProto.HEAD.getBuff(i),r],this._lteProto.HEAD_LENGTH+r.length));return s?i:void 0}this.log("client auto modify earfcn, if you want use other command , stop it first")}},{key:"packAndSendMsgAsync",value:(o=Pe(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,l=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>2&&void 0!==l[2]&&l[2],this._cellInfo.status.value!==x&&this._lteClient){e.next=4;break}return this.warn("client  disconnected, cannot send data to client"),e.abrupt("return",_e.P.ERR_LTE_DISCONNECTED);case 4:if(!this._cellInfo.earfcnAutoModing||!z.includes(t)){e.next=7;break}return this.log("client auto modify earfcn, if you want use other command , stop it first"),e.abrupt("return",_e.P.ERR_LTE_STATUS_EXCEPTION);case 7:return n?(o=this._lteProto.getBodyStruct(t),a=o.getBuff(n)):a=Buffer.from([]),r?i=this._LTETransID:(this._TransID+=1,i=this._TransID),s=i,c={FrameHeader:M,MsgType:t,MsgLength:this._lteProto.HEAD_LENGTH+a.length,Frame:this._cellInfo.Frame.value,SubSysCode:i},this.debug("lte server send msg to client ,head:".concat(JSON.stringify(c),",body:").concat(JSON.stringify(n))),e.next=14,this._sendDataAsync(Buffer.concat([this._lteProto.HEAD.getBuff(c),a],this._lteProto.HEAD_LENGTH+a.length));case 14:return e.sent,e.abrupt("return",xe(xe({},c),{},{transID:s}));case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"commonQueryAsync",value:(a=Pe(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.packAndSendMsgAsync(t,n);case 2:if(!((r=e.sent)<0)){e.next=5;break}return e.abrupt("return",[r]);case 5:return a=r.transID,o=r.MsgType,e.next=8,this.registerCBAsync(0,a,{doNotNeedCommonHandle:!0,cfgMsgType:t,ackMsgType:o});case 8:return i=e.sent,s=Ae(i,2),c=s[0],l=s[1],e.abrupt("return",[c,l]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"_handleMeasInfoPrt",value:function(e,t){var n=t.IMSI,r=t.UeMeasValue,a=t.ProtocolVer,o=r;this._cellInfo.Frame.value===V&&(o=r+54),this._latestMeasInfo={host:this.host,IMSI:n,UeMeasValue:o,ProtocolVer:a,prtTime:oe()().format("YYYY-MM-DD HH:mm:ss"),earfcn:this._cellInfo.dlEarfcn||"未知"}}},{key:"_handleSysInitSuccInd",value:function(e,t){this._intervalQuery();var n=t.CellState,r=t.Band,a=t.ulEarfcn,o=t.dlEarfcn,i=t.PLMN,s=t.Bandwidth,c=t.PCI;void 0!==n?65535===n?this.updateStatus(0):(this.updateStatus(n),65535!==r&&4294967295!==a&&4294967295!==o&&65535!==c&&255!==s&&this._updateCellInfo({Band:r,ulEarfcn:a,dlEarfcn:o,PLMN:i,Bandwidth:G.get(s),PCI:c})):this.log("cannot get CellState from SysInitSuccInd Msg body"),this.sendSysInitSuccRsp()}},{key:"_handSysArfcnAck",value:function(e,t){if(0===t.CfgResult){this.updateStatus(2);var n=this._cellInfo.settingCellInfo,r=n.dlEarfcn,a=n.ulEarfcn,o=n.Band,i=n.PLMN;r&&o&&this._updateCellInfo({dlEarfcn:r,ulEarfcn:a,Band:o,PLMN:i,settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}else this._cellInfo.settingCellInfo&&this._updateCellInfo({settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}},{key:"_handSetAdminStateAck",value:function(e,t){t.CfgResult}},{key:"_handEnbStateInd",value:function(e,t){var n=t.CellStateInd;if(n){var r=B.get(n);this.updateStatus(r.CellState),6===n&&this.sendPwr1DereaseCfg({Pwr1Derease:this._cellInfo.Pwr1Derease||0,IsSave:1}),4===n&&this.debug("device  scan net succ"),1===n&&(this._airSyncFailedRetryTimes>0?(this.activateLTEWithLastCellInfo(),this._airSyncFailedRetryTimes-=1):this._airSyncFailedRetryTimes=2)}}},{key:"_handleUeInfoPrt",value:function(e,t){if(t){var n=t.IMSI,r=t.IMEI,a=t.RSSI,o=(new Date).getTime();this.ueListCache.push({IMSI:n,IMEI:r,RSSI:a,prtTime:o})}}},{key:"_handlePowerDereaseQueryAck",value:function(e,t){var n=t.RxGainValueFromReg,r=t.RxGainValueFromMib,a=t.PowerDereaseValueFromReg,o=t.PowerDereaseValueFromMib;this._updateCellInfo({Pwr1Derease:a-(this._cellInfo.bandPwrdereaseMap[this._cellInfo.Band]||0),RxGainValueFromReg:n,RxGainValueFromMib:r,PowerDereaseValueFromReg:a,PowerDereaseValueFromMib:o})}},{key:"sendPwr1DereaseCfg",value:function(e){var t=e.Pwr1Derease,n=e.IsSave,r=this._cellInfo.bandPwrdereaseMap[this._cellInfo.Band]||0;this.log("device prePwr1Derease is ",r),void 0!==t&&void 0!==n?this.packAndSendMsg(61461,{Pwr1Derease:t+r,IsSave:n?1:0}):this.error("LTEController.sendPwr1DereaseCfg recv invalid data:".concat(JSON.stringify(e)))}},{key:"_handlePwr1DereaseAck",value:function(e,t){t.CfgResult,this.sendPowerDereaseQuery()}},{key:"_handleMeasUEAck",value:function(e,t){0===t.CfgResult&&this.sendMeasUECfgQuery()}},{key:"sendMeasUECfgQuery",value:function(){this.packAndSendMsg(61501,void 0)}},{key:"_handleMeasUECfgQueryAck",value:function(e,t){var n=t.WorkMode,r=t.RedirectSubMode,a=t.CapturePeriod,o=t.IMSI,i=t.MeasReportPeriod,s=t.SchdUeMaxPowerTxFlag,c=t.SchdUeMaxPowerValue,l=t.SchdUeUlFixedPrbSwitch,u=t.CampOnAllowedFlag,f=t.SrsSwitch,d=t.ControlSubMode;this._updateCellInfo({MeasUECfg:{WorkMode:n,RedirectSubMode:r,CapturePeriod:a,IMSI:o,MeasReportPeriod:i,SchdUeMaxPowerTxFlag:s,SchdUeMaxPowerValue:c,SchdUeUlFixedPrbSwitch:l,CampOnAllowedFlag:u,SrsSwitch:f,ControlSubMode:d}})}},{key:"sendSysInitSuccRsp",value:function(){this.packAndSendMsg(61457,void 0,!0)}},{key:"sendSycArfcnCfg",value:function(e){var t=e.dlEarfcn,n=e.PLMN,r=e.Bandwidth,a=e.Band,o=e.PCI,i=e.TAC,s=e.CellId,c=se[this.host];if(c&&-1===c.indexOf(a))setTimeout((function(){}),1e3);else if(t&&n&&r&&a&&void 0!==o&&void 0!==i&&void 0!==s){var l=K(t,this._cellInfo.Frame.value),u={ulEarfcn:l,dlEarfcn:t,PLMN:n,Bandwidth:25,Band:a,PCI:o,TAC:i,CellId:s,UePMax:23,EnodeBPMax:20};this.packAndSendMsg(U,u),this.updateStatus(2),this._updateCellInfo({settingCellInfo:{dlEarfcn:t,ulEarfcn:l,Band:a,CellId:s,PLMN:n,UePMax:23}})}else this.error("invalid input arguments, ServingCellCfgInfo:".concat(JSON.stringify(e)))}},{key:"sendSetAdminStateCfg",value:function(e){0!==e&&1!==e&&2!==e||(this.packAndSendMsg(D,{workAdminState:e}),0===e?this.updateStatus(4):this.updateStatus(2))}},{key:"sendPowerDereaseQuery",value:function(){this.packAndSendMsg(61489,void 0)}},{key:"sendGetArfcn",value:function(){this.packAndSendMsg(61479,void 0)}},{key:"sendSysModeCfg",value:function(e){var t=e.sysMode;return void 0!==t?this.packAndSendMsg(w,{sysMode:t}):(this.warn("sendSysModeCfg invalid arguments :".concat(JSON.stringify(e))),null)}},{key:"sendSysModeCfgAsync",value:function(e){var t=this;return new Promise(function(){var n=Pe(regeneratorRuntime.mark((function n(r){var a,o,i,s,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.sendSysModeCfg(e)){n.next=4;break}return r(["send failed"]),n.abrupt("return");case 4:return n.next=6,t.registerCBAsync(1,A,{doNotNeedCommonHandle:!0});case 6:if(a=n.sent,o=Ae(a,2),i=o[0],s=o[1],!i){n.next=13;break}return r([i]),n.abrupt("return");case 13:(c=s.bodyObj)&&0===c.CfgResult?r([null]):r(["cfg failed, err = ".concat(c.CfgResult)]);case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"activateLTEWithLastCellInfo",value:function(){var e=this._cellInfo,t=e.dlEarfcn,n=e.PLMN,r=e.Bandwidth,a=e.Band,o=e.PCI,i={dlEarfcn:t,PLMN:n,Bandwidth:r.value,Band:a,PCI:o,TAC:Math.floor(65535*Math.random()),CellId:he()};this.sendSycArfcnCfg(i)}},{key:"_handleSysModeAck",value:function(e,t){t.CfgResult}},{key:"sendMeasUECfg",value:function(e,t){var n=xe({WorkMode:0,RedirectSubMode:4,CapturePeriod:5,IMSI:"",MeasReportPeriod:3,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:0,SrsSwitch:0,Res:0,ControlSubMode:0,Res1:[0,0,0]},this._cellInfo.MeasUECfg),r=!1;if(void 0===e)r=!0;else switch(n.WorkMode=e,e){case 0:break;case 1:var a=t.CapturePeriod;void 0!==a&&(n.CapturePeriod=a);break;case 2:var o=t.IMSI,i=t.MeasReportPeriod,s=t.SchdUeMaxPowerValue,c=t.SchdUeUlFixedPrbSwitch,l=t.CampOnAllowedFlag,u=t.SchdUeMaxPowerTxFlag,f=t.SrsSwitch;void 0!==o&&void 0!==i&&void 0!==s&&void 0!==c&&void 0!==l&&void 0!==f&&(n=xe(xe({},n),{},{IMSI:o,MeasReportPeriod:i,SchdUeMaxPowerTxFlag:u,SchdUeMaxPowerValue:s,SchdUeUlFixedPrbSwitch:c,CampOnAllowedFlag:l,SrsSwitch:f}));break;case 3:var d=t.ControlSubMode;void 0!==d&&(n.ControlSubMode=d);break;case 4:var h=t.RedirectSubMode;void 0!==h&&(n.RedirectSubMode=h)}r?this.error("LTEController.sendMeasUECfg invalid options:".concat(JSON.stringify(t)," ,workMode:").concat(e)):this.packAndSendMsg(R,n)}},{key:"setLocateIMSI",value:function(e){this.sendMeasUECfg(2,{WorkMode:2,IMSI:e,MeasReportPeriod:4,SchdUeMaxPowerTxFlag:0,SchdUeMaxPowerValue:23,SchdUeUlFixedPrbSwitch:0,CampOnAllowedFlag:1,SrsSwitch:0})}},{key:"sendCellStateInfoQuery",value:function(){this.packAndSendMsg(61487,void 0)}},{key:"_handleCellStateInfoQueryAck",value:function(e,t){var n=t.CellState;this.updateStatus(n)}},{key:"sendEarfcnMod",value:function(e){if(e&&Number.isInteger(e)){var t=de(e);if(!t)return;var n=+t.Band,r=t.PLMN,a=K(e,this._cellInfo.Frame.value),o=he();this._updateCellInfo({settingCellInfo:{dlEarfcn:e,ulEarfcn:a,Band:n,CellId:o,PLMN:r,UePMax:23}}),this.packAndSendMsg(61568,{ulEarfcn:a,dlEarfcn:e,Band:n,PLMN:r,CellId:o,UePMax:23})}}},{key:"sendBaseInfoQuery",value:function(e){e in Object.values(W)?this.packAndSendMsg(61483,{EnbBaseInfoType:e}):this.error("Invalid EnbBaseInfoType")}},{key:"_handleBaseInfoQueryAck",value:function(e,t){var n=t.EnbBaseInfoType,r=t.EnbBaseInfo;switch(this.log(JSON.stringify(t)),n){case W.DEVICE_MODEL:case W.HARDWARE_VERSION:break;case W.SOFTWARE_VERSION:this._updateCellInfo({SOFTWARE_VERSION:r});break;case W.BOARDSN:case W.MAC:break;case W.BOARD_TEMPERATURE:var a=Math.round(+r);a&&(this._updateCellInfo({boardTemperature:a}),a>=75?(this.temperatureAlertTimes75,this.temperatureAlertTimes75+=1):this.temperatureAlertTimes75=0)}}},{key:"_handleEarfcnModAck",value:function(e,t){if(0===t.CfgResult){var n=this._cellInfo.settingCellInfo,r=n.dlEarfcn,a=n.ulEarfcn,o=n.Band,i=n.PLMN;r&&o&&this._updateCellInfo({dlEarfcn:r,ulEarfcn:a,Band:o,PLMN:i,settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}}),this.sendPwr1DereaseCfg({Pwr1Derease:this._cellInfo.Pwr1Derease,IsSave:1})}else this._cellInfo.settingCellInfo&&this._updateCellInfo({settingCellInfo:{dlEarfcn:0,ulEarfcn:0,Band:0,CellId:0,PLMN:0,UePMax:0}})}},{key:"sendRebootCfg",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.packAndSendMsg(T,{SelfActiveCfg:e})}},{key:"sendRebootCfgAsync",value:function(e){var t=this;return new Promise(function(){var n=Pe(regeneratorRuntime.mark((function n(r){var a,o,i,s,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.sendRebootCfg(e)){n.next=4;break}return r(["send failed"]),n.abrupt("return");case 4:return n.next=6,t.registerCBAsync(1,P);case 6:if(a=n.sent,o=Ae(a,2),i=o[0],s=o[1],!i){n.next=13;break}return r([i]),n.abrupt("return");case 13:0===(c=s.bodyObj).CfgResult?r([null]):r(["sendRebootCfgAsync failed, err = ".concat(c.CfgResult)]);case 15:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"_handleRebootAck",value:function(e,t){t.CfgResult}},{key:"sendMultiBandPowerdereaseQuery",value:function(){this.packAndSendMsg(61609,void 0)}},{key:"_handleMultiBandPowerdereaseQueryAck",value:function(e,t){var n=t.NumElem,r=t.bandPwrdereaseMap,a={};for(var o in r){if(+o>n)break;var i=r[o],s=i.band,c=i.Pwrderease;a[s]=c}this.log("device  bandPwrdereaseMap is ",JSON.stringify(a)),this._updateCellInfo({bandPwrdereaseMap:a})}},{key:"setModEarfcnInfo",value:function(e,t){if(e&&Array.isArray(e)&&t&&Number.isInteger(t)){var n=se[this.host];if(n){var r,a=we(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o){var i=de(o);if(!i||-1===n.indexOf(+i.Band))return}}}catch(e){a.e(e)}finally{a.f()}}this._updateCellInfo({dlEarfcnList:e,modInterval:t}),t!==this._cellInfo.modInterval&&this._cellInfo.earfcnAutoModing&&this.startAutoModEarfcn()}else this.error("LTEController.setModEarfcnInfo invalid arguments,arg:".concat(JSON.stringify({earfcnList:e,interval:t})))}},{key:"_getNextEarfcnToMod",value:function(){var e=this._cellInfo,t=e.dlEarfcnList,n=e.dlEarfcn,r=t.indexOf(n);return-1===r||r===t.length-1?t[0]:t[r+1]}},{key:"startAutoModEarfcn",value:function(){var e=this;3===this._cellInfo.status.value?0!==this._cellInfo.dlEarfcnList.length?(this._cellInfo.earfcnAutoModing&&this.autoModEarfcnProcess&&clearInterval(this.autoModEarfcnProcess),this.autoModEarfcnProcess=setInterval((function(){if(3===e._cellInfo.status.value)if(0!==e._cellInfo.dlEarfcnList.length){var t=e._getNextEarfcnToMod();t!==e._cellInfo.dlEarfcn&&(e.log("device  auto mod earfcn from [".concat(e._cellInfo.dlEarfcn,"] to [").concat(t,"]")),e.sendEarfcnMod(t))}else e.warn("device  has no dlEarfcnList, please add");else e.warn("device  has no dlEarfcnList, please add")}),1e3*this._cellInfo.modInterval),this._updateCellInfo({earfcnAutoModing:!0})):this.warn("startAutoModEarfcn failed, dlEarfcnList:".concat(this._cellInfo.dlEarfcnList)):this.warn("startAutoModEarfcn failed, status:".concat(this._cellInfo.status))}},{key:"stopAutoModEarfcn",value:function(){this.autoModEarfcnProcess&&clearInterval(this.autoModEarfcnProcess),this._updateCellInfo({earfcnAutoModing:!1})}},{key:"_sendData",value:function(e){var t=this;if(this._cellInfo.status.value!==x)return this._lteClient?(this._lteClient.sendData(e,(function(){t.debug("send data to client successfully, buffer:".concat(e.toString("hex")))})),!0):void 0;this.warn("client  disconnected, cannot send data to client")}},{key:"sendSysRxGainCfg",value:function(e,t,n){var r={RxGain:e,RxGainSaveFlag:t?1:0,RxOrSnfFlag:n};this._updateCellInfo({RxOrSnfFlag:r.RxOrSnfFlag}),this.log(JSON.stringify(r)),this.packAndSendMsg(61459,r)}},{key:"_handleSysRxGainCfgAck",value:function(e,t){0===t.CfgResult&&this.sendPowerDereaseQuery()}},{key:"sendSelfCfgCellParaReq",value:function(e){var t={SelfBand:e};this.packAndSendMsg(61519,t)}},{key:"_handleSelfCfgCellParaReqAck",value:function(e,t){t.CfgResult}},{key:"activateWithScanNetResult",value:function(e){this._cellInfo.Frame.value===V?this.sendSelfCfgCellParaReq(255):e&&e.dlEarfcn&&this.sendSycArfcnCfg(e)}},{key:"sendRemCfg",value:function(e){var t,n,r=e.wholeBandRem,a=e.sysEarfcnList,o=a.length>0?a:(t=this.host,n=this._cellInfo.Frame.value,t.includes("2.53")?n===V?[38400,38544,36275]:[1650,1825,1850,1307]:t.includes("2.54")?n===V?[37900,38098,38950,39148,40738,40940,39450,38750]:[100,2452,3650,3515]:[]);this.log("准备启动扫网 目标频点列表 ".concat(o));var i={wholeBandRem:r?1:0,sysEarfcnNum:o.length,sysEarfcn:o};this.packAndSendMsg(61449,i)}},{key:"_handleRemInfoPrt",value:function(e,t){this.log(" 准备处理扫网信息",0===t.collectionTypeFlag,JSON.stringify(t)),0===t.collectionTypeFlag||this.log("收到同步扫频消息")}},{key:"sendControlUEListCfg",value:function(e){var t=e.ControlMovement,n=e.ControlUEProperty,r=e.ControlUEIdentity,a=e.ClearType,o=void 0===a?0:a,i=e.RejCause,s=void 0===i?0:i;if(r&&0!==r.length){var c={ControlUEProperty:n,ControlMovement:t,ControlUENum:r.length,ControlUEIdentity:r,ClearType:o,RejCause:s,Res:[]};this.packAndSendMsg(61497,c)}}},{key:"_handleControlUEListCfgAck",value:function(e,t){t.CfgResult;var n=t.IgnoreUENum,r=t.IgnoreUEList,a=void 0===r?[]:r;"存在".concat(n,"个用户未删除成功 [").concat(a.join(","),"]"),"存在".concat(n,"个用户未添加成功 [").concat(a.join(","),"]"),this.initQuery()}},{key:"sendControlListQuery",value:function(e){this.packAndSendMsg(61507,{ControlListType:e,Res:[]})}},{key:"_handleControlListQueryAck",value:function(e,t){var n=t.ControlListProperty,r=t.ControlListUEId;0===n?this._updateCellInfo({blackControlList:r}):this._updateCellInfo({whiteControlList:r})}},{key:"sendGpsLocationQuery",value:function(){this.packAndSendMsg(61532,null)}},{key:"handleGpsLocationQueryAck",value:function(e,t){var n=this,r=t.Longitude,a=t.Latitude,o=t.Altitude;100===t.RateOfPro?this._updateCellInfo({Longitude:r,Latitude:a,Altitude:o}):setTimeout((function(){n.sendGpsLocationQuery()}),3e3)}},{key:"syncControlList",value:(r=Pe(regeneratorRuntime.mark((function e(t,n){var r,a,o,i,s,c,l,u,f,d,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:[],r=0===t?this._cellInfo.blackControlList:this._cellInfo.whiteControlList,a=new Set(r),o=new Set(n),i=new Set,s=new Set,c=we(n);try{for(c.s();!(l=c.n()).done;)u=l.value,!a.has(u)&&i.size<10&&i.add(u)}catch(e){c.e(e)}finally{c.f()}f=we(r);try{for(f.s();!(d=f.n()).done;)h=d.value,!o.has(h)&&s.size<10&&s.add(h)}catch(e){f.e(e)}finally{f.f()}if(!(i.size>0)){e.next=13;break}return e.next=13,this.sendControlUEListCfg({ControlUEProperty:t,ControlMovement:1,ControlUEIdentity:Array.from(i)});case 13:s.size>0&&this.sendControlUEListCfg({ControlUEProperty:t,ControlMovement:0,ControlUEIdentity:Array.from(s)});case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}])&&Be(t.prototype,n),e}(),Je=function(){for(var e=[],t=Ve.values(),n=t.next().value;n;)e.push(n),n=t.next().value;return e};function He(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ye=new Map,qe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._iotClient=void 0,this.host=t,this._status=re.get(0),this._cacheBuff=Buffer.allocUnsafe(0),this._iotProto=new ne,this.autoUpdateClock=NaN,this._iotInfo={fanSpeed:0,batteryVoltage:100}}var t,n;return t=e,(n=[{key:"startUpdateIotInfo",value:function(){var e=this;console.log("iot ctl start query"),this.autoUpdateClock=setInterval((function(){e.queryBatteryVoltage(),e.queryFanSpeed()}),3e3)}},{key:"stopUpdateIotInfo",value:function(){Number.isNaN(this.autoUpdateClock)||(console.log("iot ctl stop query"),clearInterval(this.autoUpdateClock))}},{key:"getIotInfo",value:function(){return this._iotInfo}},{key:"_updateIotInfo",value:function(e){if(e){var t=!1;for(var n in e)if(n){var r=e[n];this._iotInfo[n]!==r&&(this._iotInfo[n]=r,t=!0)}t&&console.log("iot info has changed,changed info : [".concat(JSON.stringify(this._iotInfo),"]"))}}},{key:"updateStatus",value:function(e){if(re.has(e)){0===e&&this.stopUpdateIotInfo(),1===e&&this.startUpdateIotInfo();var t=this._status;this._status=re.get(e),console.log("iot controller status changed from [".concat(t.text,"] to [").concat(this._status.text,"]"))}else console.warn("IotCtl.updateStatus invalid status:[".concat(e,"]"))}},{key:"handleMsg",value:function(e){if(Buffer.isBuffer(e))for(console.debug("recv msg from [".concat(this.host,"],buffer:").concat(e.toString("hex"))),this._cacheBuff=Buffer.concat([this._cacheBuff,e]);this._cacheBuff.length>=this._iotProto.HEAD_LEN+this._iotProto.END_LEN;){var t=e.slice(0,this._iotProto.HEAD_LEN),n=this._iotProto.HEAD_STRUCT.getObj(t),r=e.slice(this._iotProto.HEAD_LEN,this._iotProto.HEAD_LEN+n.contentLength);console.debug("recv data ,head:".concat(JSON.stringify(n),",body buffer:").concat(r.toString("hex"))),this._cacheBuff=this._cacheBuff.slice(n.contentLength+this._iotProto.HEAD_LEN+this._iotProto.END_LEN),this._parseBody(n,r)}else console.error("recv data from iot client is not buffer ,data:".concat(e))}},{key:"sendMsg",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t){var r;r=1===t?this._iotProto.getBodyStruct(e).getBuff(n):this._iotProto.IOT_COMMON_QUERY.getBuff();var a=this._iotProto.HEAD_STRUCT.getBuff({fixHead:ee,funCode:e,cmd:t,contentLength:r.length}),o=this._iotProto.END_STRUCT.getBuff({fixEnd:126}),i=Buffer.concat([a,r,o]);console.debug("iot client send data:".concat(JSON.stringify({funCode:e,cmd:t,content:n}),",buffer :[").concat(i.toString("hex"),"]")),this._iotClient.sendData(i)}else console.error("iotCtl.sendMsg invalid arguments ".concat(JSON.stringify({funCode:e,cmd:t,content:n})))}},{key:"_parseBody",value:function(e,t){var n=e.funCode,r=e.cmd;if(n)if(130===r){var a=this._iotProto.getBodyStruct(n).getObj(t);switch(console.debug("\n        recv msg from iot client [".concat(this.host,"],headObj:").concat(JSON.stringify(e),",bodyObj:").concat(JSON.stringify(a))),n){case 209:console.debug("recv msg type [CLIENT_IP] from iot client [".concat(this.host,"]"));break;case 214:console.debug("recv msg type [SERVER_IP] from iot client [".concat(this.host,"]"));break;case 215:console.debug("recv msg type [SERVER_PORT] from iot client [".concat(this.host,"]"));break;case 1:this._handleFanSpeedAck(e,a),console.debug("recv msg type [FAN_SPEED] from iot client [".concat(this.host,"]"));break;case 2:console.debug("recv msg type [TEMPERATURE] from iot client [".concat(this.host,"]"));break;case 3:this._handleBatteryVoltageAck(e,a),console.debug("recv msg type [BATTERY_VOLTAGE] from iot client [".concat(this.host,"]"));break;default:console.warn("IotCtl._parseBody not support this funCode[".concat(n,"],headObj:[").concat(JSON.stringify(e),"]"))}}else 129===r||241===r||console.warn("recv other cmd msg headObj:".concat(JSON.stringify(e)));else console.error("IotCtl._parseBody get invalid headObj :[".concat(e,"]"))}},{key:"_handleBatteryVoltageAck",value:function(e,t){var n=t.batteryVoltage;n?((n<=10||n<=20)&&this._iotInfo.batteryVoltage,this._updateIotInfo({batteryVoltage:n})):console.log("_handleBatteryVoltageAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"_handleFanSpeedAck",value:function(e,t){var n=t.fanSpeed;n?this._updateIotInfo({fanSpeed:n}):console.log("_handleFanSpeedAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"_handleTemperatureAck",value:function(e,t){var n=t.temperature;(n=(+n-50)/10)&&!Number.isNaN(n)?this._updateIotInfo({temperature:n}):console.log("_handleTemperatureAck recv valid arguments,headObj:".concat(JSON.stringify(e),",bodyObj:").concat(t))}},{key:"queryTemperature",value:function(){this.sendMsg(2,2)}},{key:"queryFanSpeed",value:function(){this.sendMsg(1,2)}},{key:"queryBatteryVoltage",value:function(){this.sendMsg(3,2)}},{key:"setFanSpeed",value:function(e){void 0!==e&&"number"==typeof e?e>100||e<0?console.warn("iotCtl.setFanSpeed fanSpeed is not in valid range, fanSpeed:".concat(e)):this.sendMsg(1,1,{fanSpeed:e}):console.error("iotCtl.setFanSpeed get invalid arguments fanSpeed:".concat(e))}},{key:"initClient",value:function(e){var t=this;this._iotClient?console.log("iot client [".concat(this.host,"] reconnected")):console.log("iot client [".concat(this.host,"] connected")),this.updateStatus(1),this._iotClient=e,this._iotClient.registerHandler("data",this.handleMsg.bind(this)),this._iotClient.registerHandler("error",(function(e){e&&(console.error("iot controller [".concat(t.host,"] got error:").concat(e)),t._iotClient.destroy())})),this._iotClient.registerHandler("close",(function(){t.updateStatus(0),console.warn("iot controller [".concat(t.host,"] disconnected"))}))}}])&&He(t.prototype,n),e}(),Ke=function(e,t){var n;return Ye.has(e)?(n=Ye.get(e),console.warn("iot controller for [".concat(e,"] existed, update its client"))):(console.log("init new iot controller [".concat(e,"]")),n=new qe(e),Ye.set(e,n)),n.initClient(t),n};function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const Xe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t,this.remoteAddress=this._client.address().address,this.authenticated=!1,this._initClient(),"192.168.2.52"===this.remoteAddress&&(Ke(this.remoteAddress,this),this.authenticated=!0)}var t,n;return t=e,(n=[{key:"_initClient",value:function(){var e=this;this._client.setTimeout(1e4),this._client.on("close",(function(t){t?(console.error(t),console.log("client [".concat(e.remoteAddress,"] close and err occur"))):console.log("client [".concat(e.remoteAddress,"] close"))})),this._client.on("data",(function(t){if(!e.authenticated)if(Buffer.isBuffer(t)){var n=Buffer.allocUnsafe(4);if(t.copy(n,0,0,4),0===n.compare(Buffer.from(I))){console.log("new lte client authenticated successful");var r=(a=e.remoteAddress,o=e,Ve.has(a)?(i=Ve.get(a),console.warn("lte controller for [".concat(a,"] existed, update its client"))):(console.log("init new lte controller [".concat(a,"]")),i=new Qe(a),Ve.set(a,i)),i.initClient(o),i);r&&r.handMsg(t),e.authenticated=!0}else 0===n.compare(Buffer.from(te))?(console.log("new iot client authenticated successful"),Ke(e.remoteAddress,e).handleMsg(t),e.authenticated=!0):console.warn("client [".concat(e.remoteAddress,"] recv msg headframe invalid"))}else console.warn("recv data not buffer ,data:".concat(t));var a,o,i})),this._client.on("end",(function(){console.warn("client [".concat(e.remoteAddress,"] end!"))})),this._client.on("error",(function(t){console.warn("client [".concat(e.remoteAddress,"] got error:[").concat(t,"]"))})),this._client.on("timeout",(function(){console.warn("client [".concat(e.remoteAddress,"] timeout"))})),console.log("client [".concat(this.remoteAddress,"] init success"))}},{key:"sendData",value:function(e,t){e&&("string"==typeof e||Buffer.isBuffer(e))?this._client.write(e,t):console.warn("client [".concat(this.remoteAddress,"] send invalid data:[").concat(e,"]"))}},{key:"registerHandler",value:function(e,t){this._client.on(e,t),console.log("register event[".concat(e,"] on client[").concat(this.remoteAddress,"] successful"))}},{key:"destroy",value:function(){this._client.destroy()}}])&&We(t.prototype,n),e}();function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const $e=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._port=t,this._server=(0,r.createServer)((function(e){new Xe(e)})),this._server.on("error",(function(e){e&&console.error("lte server got error :".concat(e))})),this._server.on("close",(function(){console.error("lte server closed")}))}var t,n;return t=e,(n=[{key:"startServer",value:function(){this._server.listen(this._port),console.log("server listen on port [".concat(this._port,"]"))}}])&&ze(t.prototype,n),e}(),Ze=require("log4js");var et=n.n(Ze);const tt=JSON.parse('{"appenders":{"fileError":{"type":"file","filename":"logs/error.log","layout":{"type":"pattern","pattern":"[%r] [%p] - %m"}},"fileDefault":{"daysToKeep":7,"keepFileExt":true,"type":"dateFile","pattern":".yyyy-MM-dd","filename":"logs/all/default.log","compress":true,"layout":{"type":"pattern","pattern":"[%r] [%p] - %m"}},"console":{"type":"console"}},"categories":{"error":{"appenders":["console","fileError","fileDefault"],"level":"error"},"default":{"appenders":["console","fileDefault"],"level":"trace"}},"pm2":true}');var nt=n(903),rt=n(876),at=new Map,ot=function(){return[null,"hello"]},it=function(e){var t=e.configKey,n=e.configData;if(t){if(Number.isNaN(parseInt(t))&&at.has(t))return at.get(t)(n)}else console.warn("invalid configKey [".concat(t,"]"));return[_e.P.ERR_INVALID_CONFIG_KEY]};function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ct(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}at.set("SetAutoModEarfcn",(function(e){var t,n=e.dlEarfcnList,r=e.earfcnAutoModing,a=e.modInterval,o=(t=e.host,Ve.get(t));return o.setModEarfcnInfo(n,a),r?o.startAutoModEarfcn():o.stopAutoModEarfcn(),[null,null]}));var ut=Oe.wsServerCfg;const ft=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.deviceID=(0,Ne.d)(rt.oh.LTE),this.ws=new nt.Z("".concat(ut.host,":").concat(ut.port),ut.namespace,{query:{deviceID:this.deviceID}}),this.startListen()}var t,n;return t=e,(n=[{key:"connected",value:function(){return this.ws.connected()}},{key:"startListen",value:function(){var e=this.ws,t=e.listen;e.wrap,t("hello",this.handler(ot)),t("config",this.handler(it))}},{key:"handler",value:function(e){var t=this.ws,n=(t.listen,t.wrap);return function(){var t,r=(t=regeneratorRuntime.mark((function t(r,a){var o,i,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(r);case 3:if(t.t0=t.sent,t.t0){t.next=6;break}t.t0=[];case 6:o=t.t0,u=2,i=function(e){if(Array.isArray(e))return e}(l=o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}}(l,u)||function(e,t){if(e){if("string"==typeof e)return st(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?st(e,t):void 0}}(l,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),s=i[0],c=i[1],n(a,c,null===s?void 0:s),t.next=17;break;case 13:t.prev=13,t.t1=t.catch(0),console.error(t.t1),n(a,null,t.t1);case 17:case"end":return t.stop()}var l,u}),t,null,[[0,13]])})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){ct(o,r,a,i,s,"next",e)}function s(e){ct(o,r,a,i,s,"throw",e)}i(void 0)}))});return function(e,t){return r.apply(this,arguments)}}()}},{key:"emitAsync",value:function(){var e;return(e=this.ws).emitAsync.apply(e,arguments)}}])&&lt(t.prototype,n),e}()),dt=require("node-schedule");var ht=n(172);const _t=require("coordtransform");var gt=n.n(_t);function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){Et(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pt(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function mt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){pt(o,r,a,i,s,"next",e)}function s(e){pt(o,r,a,i,s,"throw",e)}i(void 0)}))}}function St(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=bt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function bt(e,t){if(e){if("string"==typeof e)return Lt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lt(e,t):void 0}}function Lt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Nt=new(function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Et(this,"ifNeedSyncDeviceInfo",(function(){return t.deviceInfoChanged})),this.status={},this.deviceInfoChanged=!0,this.listenCellInfoChange(),this.deviceInfo={status:rt.cP.EXCEPTION,liveGps:{Longitude:122-3*Math.random(),Latitude:34-3*Math.random(),Altitude:0},deviceType:rt.oh.LTE,updateTime:oe()().unix(),deviceDetails:[]}}var t,n,r,a;return t=e,(n=[{key:"syncedCellInfo",value:function(){this.deviceInfoChanged=!1}},{key:"listenCellInfoChange",value:function(){var e=this;pe.on(me,(function(t){t.host,t.cellInfo,e.updateDeviceInfo(),e.deviceInfoChanged=!0}))}},{key:"getDeviceInfo",value:function(){return this.deviceInfo}},{key:"updateDeviceInfo",value:function(){var e,t=Je();this.deviceInfo.deviceDetails=t.map((function(e){return{host:e.host,cellInfo:e.getCellInfo()}}));var n,r,a=[],o=[],i=[],s=(Et(e={},x,0),Et(e,0,0),Et(e,2,0),Et(e,3,0),Et(e,4,0),Et(e,1,0),e),c=St(t);try{for(c.s();!(n=c.n()).done;){var l=n.value.getCellInfo();s[l.status.value]+=1,l.Longitude&&a.push(l.Longitude),l.Latitude&&o.push(l.Latitude),l.Altitude&&i.push(l.Altitude)}}catch(e){c.e(e)}finally{c.f()}if(a.length>0&&o.length>0&&i.length>0){var u=a.reduce((function(e,t){return e+t}))/a.length,f=o.reduce((function(e,t){return e+t}))/o.length,d=i.reduce((function(e,t){return e+t}))/i.length,h=gt().wgs84togcj02(u,f);gt().gcj02tobd09.apply(gt(),function(e){if(Array.isArray(e))return Lt(e)}(r=h)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(r)||bt(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.deviceInfo.liveGps={Longitude:u,Latitude:f,Altitude:d}}s[3]===t.length?this.deviceInfo.status=rt.cP.WORKING:s[0]===t.length?this.deviceInfo.status=rt.cP.IDLE:this.deviceInfo.status=rt.cP.EXCEPTION}},{key:"syncDeviceInfo",value:(a=mt(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.deviceInfoChanged||!(oe()().unix()-this.deviceInfo.updateTime<30)){e.next=2;break}return e.abrupt("return");case 2:if(ft.connected()){e.next=4;break}return e.abrupt("return");case 4:return this.deviceInfo.updateTime=oe()().unix(),e.next=7,ft.emitAsync("syncDeviceInfo",vt(vt({},this.deviceInfo),{},{save:this.deviceInfoChanged}));case 7:if(!(t=e.sent)||0!==t.code){e.next=14;break}return console.log("sync deviceinfo successfully!!!"),this.deviceInfoChanged=!1,e.abrupt("return",!0);case 14:return console.log("syncDeviceInfo failed, err = ",t),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"sendUEList",value:(r=mt(regeneratorRuntime.mark((function e(t){var n,r,a,o,i,s,c,l,u,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",!0);case 2:if(ft.connected()){e.next=4;break}return e.abrupt("return",!1);case 4:n={},r=St(t);try{for(r.s();!(a=r.n()).done;)o=a.value,i=o.IMSI,s=o.IMEI,c=o.RSSI,l=o.prtTime,u="".concat(i,"_").concat(s),n[u]?(n[u].prtTimeList.push(l),n[u].RSSIList.push(c)):n[u]={IMSI:i,IMEI:s,prtTimeList:[l],RSSIList:[c]}}catch(e){r.e(e)}finally{r.f()}return f=Object.values(n),e.next=10,ft.emitAsync("uploadUEList",{ueList:f});case 10:if(!(d=e.sent)||0!==d.code){e.next=16;break}return console.log("upload uelist[".concat(t.length,"] successfully!!!")),e.abrupt("return",!0);case 16:return console.log("uploadOfflineUE failed, err = ",d),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})}])&&Ct(t.prototype,n),e}());function Mt(e,t,n,r,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,a)}function It(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Mt(o,r,a,i,s,"next",e)}function s(e){Mt(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Ot(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=wt(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function wt(e,t){if(e){if("string"==typeof e)return At(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?At(e,t):void 0}}function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Rt=[{enable:!0,schedule:"*/1 * * * * *",handle:function(e){return e.syncDeviceStatus}},{enable:!0,schedule:"*/5 * * * * *",handle:function(e){return e.uploadUEList}},{enable:!0,schedule:"*/20 * * * * *",handle:function(e){return e.uploadOfflineUE}}];const Tt=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,a,o;return t=e,(n=[{key:"start",value:function(){var e,t=Ot(Rt);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.enable,a=n.handle,o=n.schedule;r&&(0,dt.scheduleJob)(o,a(this))}}catch(e){t.e(e)}finally{t.f()}}},{key:"syncDeviceStatus",value:(o=It(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nt.syncDeviceInfo();case 2:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"uploadUEList",value:(a=It(regeneratorRuntime.mark((function e(){var t,n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Je(),n=[],r=Ot(t);try{for(r.s();!(a=r.n()).done;)o=a.value,i=o.getAndClearUEList(),n.push.apply(n,function(e){if(Array.isArray(e))return At(e)}(s=i)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(s)||wt(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}catch(e){r.e(e)}finally{r.f()}if(0!==n.length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,Nt.sendUEList(n);case 8:e.sent||(0,ht.cW)(n);case 10:case"end":return e.stop()}var s}),e)}))),function(){return a.apply(this,arguments)})},{key:"uploadOfflineUE",value:(r=It(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ft.connected()){e.next=2;break}return e.abrupt("return");case 2:if(t=(0,ht.RG)(),n=t.rows,r=t.deleteRows,0!==n.length){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Nt.sendUEList(n);case 7:e.sent&&r();case 9:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}])&&Ut(t.prototype,n),e}());!function(e){tt.appenders.fileDefault.filename="logs/".concat("lte","/default.log"),tt.appenders.fileError.filename="logs/".concat("lte","/error.log"),et().configure(tt);var t=et().getLogger("error"),n=et().getLogger("default");console.trace=n.trace.bind(n),console.debug=n.debug.bind(n),console.info=n.info.bind(n),console.log=n.info.bind(n),console.warn=n.warn.bind(n),console.error=t.error.bind(t)}(),(0,ht.zK)(),function(e){if(e)for(var t in e)Ve.has(t)?console.warn("createLteCtrls got exception ,lteCellInfos:[".concat(JSON.stringify(e),"]")):Ve.set(t,new Qe(t,e[t]))}(Ge),Tt.start(),new $e(3345).startServer()},903:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});const r=require("socket.io-client");var a=n.n(r),o=n(385);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e=n.hmd(e);var f=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};c(this,e),u(this,"initLog",(function(){for(var e=function(){var e=n[t];r[e]=function(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=console)[e].apply(t,["[".concat(r.socket.id,"]")].concat(a))}},t=0,n=["debug","log","warn","error"];t<n.length;t++)e()})),u(this,"init",(function(e){r.socket.on("connect",(function(){r.log("".concat(r.url," connect"))}))})),u(this,"emit",(function(e,t,n){if(!r.connected())return r.warn("can not emit event, ws client disconnected"),void n(o.P.ERR_WS_DISCONNECTED);r.socket.emit(e,t,(function(){r.log("emit [".concat(e,"] req:[").concat(JSON.stringify(t),"] res:[").concat(JSON.stringify.apply(JSON,arguments),"]")),n.apply(void 0,arguments)}))})),u(this,"emitAsync",(function(e,t){return new Promise((function(n){r.emit(e,t,n)}))})),u(this,"listen",(function(e,t){r.socket.on(e,(function(n,a){r.log("ltews listened event[".concat(e,"] data[").concat(JSON.stringify(n),"]")),t(n,a)}))})),u(this,"wrap",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.P.SUCCESS;if("function"==typeof e){var a={code:o.P.SUCCESS,msg:o.l.get(o.P.SUCCESS).msg,data:t};o.l.has(n)?(a.code=n,a.msg=o.l.get(n).msg):(a.code=o.P.ERR_UNKNOWN,a.msg=o.l.get(o.P.ERR_UNKNOWN).msg),r.log("ws wrap msg [".concat(JSON.stringify(a),"]")),e(a)}})),this.host=t,this.namespace=n,this.url="ws://".concat(t).concat(n),this.socket=a()(this.url,s({autoConnect:!0,withCredentials:!0,reconnection:!0},i)).compress(!0),this.initLog(),this.init()}var t,n;return t=e,(n=[{key:"connected",value:function(){return this.socket.connected}}])&&l(t.prototype,n),e}();const d=f;n.c[n.s]===e&&new f("127.0.0.1","/lte","asdjksahdkjsahd")},438:(e,t,n)=>{"use strict";n.d(t,{d:()=>h,k:()=>_});const r=require("uuid"),a=require("crypto");var o=n.n(a),i=n(876),s=n(747),c=n.n(s);const l=require("assert");var u=n.n(l),f=n(622),d=n.n(f);function h(e){var t,n=i.fH.get(e),a="".concat(i.xX,"/").concat(n.prefix,"_DEVICEID");if(!t){var s=o().createHash("md5");t="".concat(n.prefix).concat("_").concat(s.update((0,r.v4)()).digest("hex").toUpperCase().slice(0,12)),c().writeFileSync(a,t,"utf-8")}return u()(16===t.length),t}function _(e){return!!c().existsSync(e)||(_(d().dirname(e))?(c().mkdirSync(e),!0):void 0)}e=n.hmd(e),n.c[n.s]===e&&(console.log(h(i.oh.LTE)),_("config/config/default.local.json"))},172:(e,t,n)=>{"use strict";n.d(t,{RG:()=>f,zK:()=>u,cW:()=>d});const r=require("better-sqlite3");var a=n.n(r),o=n(622),i=n.n(o),s=n(497);e=n.hmd(e);const c=i().join(__dirname,"./ss.db");let l;function u(){l=new(a())(c,{verbose:console.debug}),l.exec(s.table)}function f(){const e=(new Date).getTime();return{rows:l.prepare("SELECT * from ue where prtTime <= ?").all(e),deleteRows:()=>{try{return l.prepare("DELETE FROM ue WHERE prtTime <= ?").run(e).changes}catch(e){if(e)return console.error("delete data failed, error = ",e),0}}}}function d(e){try{const t=l.prepare("INSERT INTO UE (IMSI,IMEI,RSSI,prtTime) VALUES (@IMSI,@IMEI,@RSSI,@prtTime)");for(const n of e)t.run(n);return e.length}catch(e){if(e)return console.error("saveOfflineUE failed, err = ",e),0}}if(n.c[n.s]===e){u();const{rows:e,deleteRows:t}=f();console.log(e.length)}},497:e=>{e.exports={table:"\nCREATE TABLE IF NOT EXISTS ue (\n    IMSI CHAR(17) NOT NULL DEFAULT '',\n    IMEI CHAR(17) NOT NULL DEFAULT '',\n    RSSI TINYINT NOT NULL DEFAULT 0,\n    prtTime INT NOT NULL DEFAULT 0\n); \n"}},294:e=>{"use strict";e.exports=require("babel-polyfill")},747:e=>{"use strict";e.exports=require("fs")},622:e=>{"use strict";e.exports=require("path")}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r](o,o.exports,n),o.loaded=!0,o.exports}n.c=t,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(n.s=294),n(n.s=345)})();